<!doctype html>
<html class="no-js" lang="vi"> <!--<![endif]-->

<meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->

<head>
	<!-- Basic page needs ================================================== -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta property="og:locale" content="vi_VN">
	<link rel="alternate" hreflang="x-default" href="index.html">
	<link rel="alternate" hreflang="vi" href="index.html">
	<meta name="revisit" content="1 days">
	<meta name="robots" content="index,follow">
	<!-- Meta Pixel Code -->
	<script>
		!function (f, b, e, v, n, t, s) {
			if (f.fbq) return; n = f.fbq = function () {
				n.callMethod ?
					n.callMethod.apply(n, arguments) : n.queue.push(arguments)
			};
			if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
			n.queue = []; t = b.createElement(e); t.async = !0;
			t.src = v; s = b.getElementsByTagName(e)[0];
			s.parentNode.insertBefore(t, s)
		}(window, document, 'script',
			'https://connect.facebook.net/en_US/fbevents.js');
		fbq('init', '1183122993099354');
		fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none"
			src="https://www.facebook.com/tr?id=1183122993099354&ev=PageView&noscript=1" /></noscript>
	<!-- End Meta Pixel Code -->
	<!-- Meta Pixel Code -->
	<script>
		!function (f, b, e, v, n, t, s) {
			if (f.fbq) return; n = f.fbq = function () {
				n.callMethod ?
					n.callMethod.apply(n, arguments) : n.queue.push(arguments)
			};
			if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
			n.queue = []; t = b.createElement(e); t.async = !0;
			t.src = v; s = b.getElementsByTagName(e)[0];
			s.parentNode.insertBefore(t, s)
		}(window, document, 'script',
			'https://connect.facebook.net/en_US/fbevents.js');
		fbq('init', '694234706407697');
		fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none"
			src="https://www.facebook.com/tr?id=694234706407697&ev=PageView&noscript=1" /></noscript>
	<!-- End Meta Pixel Code -->
	<link rel="shortcut icon" href="../theme.hstatic.net/1000313040/1000406925/14/faviconee64.png" type="image/png" />

	<!-- Title and description ================================================== -->
	<title>
		Bánh Mì Chảo Thương Nhớ
	</title>
	<meta property="og:type" content="website">
	<meta property="og:title" content="Bánh Mì Chảo Thương Nhớ">

	<!--<meta property="og:image" content="http://theme.hstatic.net/1000313040/1000406925/14/logo.png">-->
	<!--<meta property="og:image:secure_url" content="https://theme.hstatic.net/1000313040/1000406925/14/logo.png">-->


	<meta property="og:url" content="https://banhmichaothuongnho.com">
	<meta property="og:site_name" content="Bánh Mì Chảo Thương Nhớ">

	<meta name="twitter:site" content="@https://">
	<meta name="twitter:card" content="summary">

	<link rel="canonical" href="index.html">
	<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
	<meta name="theme-color" content="#3d1a1a">
	<!-- CSS ================================================== -->
	<link href='../theme.hstatic.net/1000313040/1000406925/14/timber.scssee64.css' rel='stylesheet' type='text/css'
		media='all' />
	<link href='../theme.hstatic.net/1000313040/1000406925/14/check_outee64.css' rel='stylesheet' type='text/css'
		media='all' />
	<link href='../theme.hstatic.net/1000313040/1000406925/14/style-cafesuplo.scssee64.css' rel='stylesheet'
		type='text/css' media='all' />
	<link href='../theme.hstatic.net/1000313040/1000406925/14/owl.carouselee64.css' rel='stylesheet' type='text/css'
		media='all' />
	<link href='../theme.hstatic.net/1000313040/1000406925/14/owl.themeee64.css' rel='stylesheet' type='text/css'
		media='all' />
	<link href='../theme.hstatic.net/1000313040/1000406925/14/owl.transitionsee64.css' rel='stylesheet' type='text/css'
		media='all' />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
		integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

	<script src='../ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js' type='text/javascript'></script>
	<script src='../theme.hstatic.net/1000313040/1000406925/14/modernizr.minee64.js' type='text/javascript'></script>
	<script src='../theme.hstatic.net/1000313040/1000406925/14/owl.carousel.minee64.js' type='text/javascript'></script>

</head>

<body id="banhmichaothuongnho" class="template-collection">

	<div id="NavDrawer" class="drawer drawer--left">
		<div class="drawer__header">
			<div class="drawer__title h3"><img src="../theme.hstatic.net/1000313040/1000406925/14/logoee64.png"
					alt="Bánh Mì Chảo Thương Nhớ" /></div>
			<div class="drawer__close js-drawer-close">
				<button type="button" class="icon-fallback-text">
					<span class="icon icon-x" aria-hidden="true"></span>
					<span class="fallback-text">Đóng</span>
				</button>
			</div>
		</div>
		<!-- begin mobile-nav -->
		<ul class="mobile-nav">
			<li class="mobile-nav__item mobile-nav__search">
				<form action="./collections/search.html" method="get" class="input-group search-bar home-search-bar"
					role="search">
					<input type="hidden" name="type" value="product">
					<input type="search" name="q" value="" placeholder="Tìm kiếm..." class="input-group-field"
						aria-label="Tìm kiếm...">
					<span class="input-group-btn">
						<button type="submit" class="btn icon-fallback-text">
							<span class="icon icon-search" aria-hidden="true"></span>
							<span class="fallback-text">Tìm kiếm</span>
						</button>
					</span>
				</form>

			</li>
		</ul>
		<!-- //mobile-nav -->
	</div>


	<div id="CartDrawer" class="drawer drawer--right">
		<div class="drawer__header">
			<div class="drawer__title h3">Giỏ hàng</div>
			<div class="drawer__close js-drawer-close">
				<button type="button" class="icon-fallback-text">
					<span class="icon icon-x" aria-hidden="true"></span>
					<span class="fallback-text">"Đóng"</span>
				</button>
			</div>
		</div>
		<div id="CartContainer"></div>
	</div>
	<div class="cart-overlay"></div>


	<header class="medium-down--hide">
		<div id="site-header" class="medium-down--hide ">
			<div class="wrapper">
				<div class="inner">
					<div class="grid mg-left-15">
						<div class="grid__item large--one-twelfth pd-left0">
							<div class="hd-logo">



								<a href="index.html">
									<img class="avata" src="../theme.hstatic.net/1000313040/1000406925/14/logoee64.png"
										alt="Bánh Mì Chảo Thương Nhớ" />
								</a>


							</div>
						</div>
						<div class="grid__item large--three-twelfths pd-left15 hd-searchbar">
							<form action="./collections/search.html" method="get"
								class="input-group search-bar home-search-bar" role="search">
								<input type="hidden" name="type" value="product">
								<input type="search" name="q" value="" placeholder="Tìm kiếm..."
									class="input-group-field" aria-label="Tìm kiếm...">
								<span class="input-group-btn">
									<button type="submit" class="btn icon-fallback-text">
										<span class="icon icon-search" aria-hidden="true"></span>
										<span class="fallback-text">Tìm kiếm</span>
									</button>
								</span>
							</form>
						</div>
						<div class="grid__item large--eight-twelfths pd-left15">
							<div class="fix-hd">
								<a href="tel:093 1387 046">
									<i class="fa fa-phone" aria-hidden="true"></i>
									<span>093 1387 046</span>
								</a>
								<a href="pages/he-thong-cua-hang.html">
									<i class="fa fa-building" aria-hidden="true"></i>
									<span>Hệ thống <b>5</b> cửa hàng</span>
								</a>
								<a href="cart.html">
									<div class="cart-total-price">
										<i class="fa fa-shopping-bag" aria-hidden="true"></i>
										<span id="CartCount">0</span>
									</div>
								</a>
							</div>
						</div>
					</div>
					<div class="grid mg-left-15">
						<div class="grid__item large--one-whole pd-left0">
							<div id="topmenu">
								<div class="wrapper">
									<div class="inner">
										<div class="grid mg-left-15">
											<div class="grid__item large--one-whole pd-left15">
												<div class="hd-navbar">
													<ul class="no-bullets" id="menu-container">
														<!-- Menu sẽ được tạo động từ dữ liệu JSON -->
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>

	<!-- tạo danh mục menu -->
	<script>
		function createMenu(menuData) {
			const menuContainer = document.getElementById('menu-container');

			// Xóa nội dung cũ nếu có
			menuContainer.innerHTML = '';

			// Tạo menu từ dữ liệu
			menuData.categories.forEach(category => {
				// Tạo phần tử li cho mỗi danh mục
				const categoryLi = document.createElement('li');
				categoryLi.className = 'dropdown';

				// Tạo liên kết cho danh mục
				const categoryLink = document.createElement('a');
				categoryLink.href = category.url;
				categoryLink.innerHTML = `${category.name} <i class="fa fa-angle-down" aria-hidden="true"></i>`;
				categoryLi.appendChild(categoryLink);

				// Tạo submenu cho sản phẩm
				if (category.products && category.products.length > 0) {
					const submenu = document.createElement('ul');
					submenu.className = 'no-bullets dropdown-menu';

					// Thêm các sản phẩm vào submenu
					category.products.forEach(product => {
						const productLi = document.createElement('li');
						const productLink = document.createElement('a');
						productLink.href = product.url;
						productLink.textContent = product.name;
						productLi.appendChild(productLink);
						submenu.appendChild(productLi);
					});

					categoryLi.appendChild(submenu);
				}

				// Thêm danh mục vào menu chính
				menuContainer.appendChild(categoryLi);
			});
		}

		// Hàm để tải dữ liệu JSON từ tệp
		function loadMenuData() {
			fetch('products/getData.php?file=menu-data')  // Tên tệp JSON của bạn
				.then(response => {
					if (!response.ok) {
						throw new Error('Không thể tải dữ liệu menu');
					}
					return response.json();
				})
				.then(data => {
					createMenu(data);
				})
				.catch(error => {
					console.error('Lỗi khi tải dữ liệu menu:', error);
				});
		}

		// Tải menu khi trang được tải
		document.addEventListener('DOMContentLoaded', loadMenuData);
	</script>

	<script>
		// Hàm để tải menu từ file JSON
		function loadMenuFromJSON() {
			fetch('products/getData.php?file=menu-data')  // Giả định là bạn đã lưu file JSON với tên này
				.then(response => {
					if (!response.ok) {
						throw new Error('Network response was not ok');
					}
					return response.json();
				})
				.then(data => {
					renderMenu(data);
				})
				.catch(error => {
					console.error('Có lỗi khi tải dữ liệu menu:', error);
				});
		}

		// Hàm để render menu từ dữ liệu JSON
		function renderMenu(data) {
			const navDrawer = document.getElementById('NavDrawer');
			const mobileNav = document.createElement('ul');
			mobileNav.className = 'mobile-nav';

			// Tạo phần tìm kiếm
			const searchItem = document.createElement('li');
			searchItem.className = 'mobile-nav__item mobile-nav__search';
			searchItem.innerHTML = `
<form action="./collections/search.html" method="get" class="input-group search-bar home-search-bar" role="search">
  <input type="hidden" name="type" value="product">
  <input type="search" name="q" value="" placeholder="Tìm kiếm..." class="input-group-field" aria-label="Tìm kiếm...">
  <span class="input-group-btn">
    <button type="submit" class="btn icon-fallback-text">
      <span class="icon icon-search" aria-hidden="true"></span>
      <span class="fallback-text">Tìm kiếm</span>
    </button>
  </span>
</form>
`;
			mobileNav.appendChild(searchItem);

			// Thêm các mục menu từ dữ liệu JSON
			data.categories.forEach(category => {
				const categoryItem = document.createElement('li');

				if (category.products && category.products.length > 0) {
					// Danh mục có các sản phẩm con
					categoryItem.className = 'mobile-nav__item';
					categoryItem.setAttribute('aria-haspopup', 'true');

					categoryItem.innerHTML = `
    <div class="mobile-nav__has-sublist">
      <a href="${category.url}" class="mobile-nav__link">${category.name}</a>
      <div class="mobile-nav__toggle">
        <button type="button" class="icon-fallback-text mobile-nav__toggle-open">
          <span class="icon icon-plus" aria-hidden="true"></span>
          <span class="fallback-text">See More</span>
        </button>
        <button type="button" class="icon-fallback-text mobile-nav__toggle-close">
          <span class="icon icon-minus" aria-hidden="true"></span>
          <span class="fallback-text">"Đóng"</span>
        </button>
      </div>
    </div>
    <ul class="mobile-nav__sublist">
      ${category.products.map(product => `
        <li class="mobile-nav__item" aria-haspopup="true">
          <div class="mobile-nav__has-sublist">
            <a href="${product.url}" class="mobile-nav__link">${product.name}</a>
          </div>
        </li>
      `).join('')}
    </ul>
  `;
				} else {
					// Danh mục không có sản phẩm con
					categoryItem.className = 'mobile-nav__item';
					categoryItem.innerHTML = `
    <a href="${category.url}" class="mobile-nav__link">${category.name}</a>
  `;
				}

				mobileNav.appendChild(categoryItem);
			});

			// Xóa menu cũ và thêm menu mới
			const oldMobileNav = navDrawer.querySelector('.mobile-nav');
			if (oldMobileNav) {
				navDrawer.removeChild(oldMobileNav);
			}
			navDrawer.appendChild(mobileNav);

			// Thêm event listeners cho các nút toggle
			addToggleListeners();
		}

		// Hàm để thêm event listeners cho các nút toggle - ĐÃ SỬA LẠI
		function addToggleListeners() {
			const toggleButtons = document.querySelectorAll('.mobile-nav__toggle');

			toggleButtons.forEach(button => {
				button.addEventListener('click', function () {
					// Lấy phần tử cha .mobile-nav__has-sublist
					const hasSublist = this.closest('.mobile-nav__has-sublist');
					const openButton = this.querySelector('.mobile-nav__toggle-open');
					const closeButton = this.querySelector('.mobile-nav__toggle-close');

					// Toggle class mobile-nav--expanded cho hasSublist
					if (hasSublist.classList.contains('mobile-nav--expanded')) {
						hasSublist.classList.remove('mobile-nav--expanded');
						openButton.style.display = 'inline-block';
						closeButton.style.display = 'none';
					} else {
						hasSublist.classList.add('mobile-nav--expanded');
						openButton.style.display = 'none';
						closeButton.style.display = 'inline-block';
					}
				});
			});
		}

		// Tải menu khi trang đã tải xong
		document.addEventListener('DOMContentLoaded', loadMenuFromJSON);
	</script>

	<script>
		// Script để lấy dữ liệu danh mục menu từ file JSON
		document.addEventListener('DOMContentLoaded', function () {
			// Đường dẫn đến file JSON của bạn
			const jsonFilePath = 'products/getData.php?file=menu-data';

			// Hàm để tải dữ liệu từ file JSON
			function loadMenuData() {
				fetch(jsonFilePath)
					.then(response => {
						if (!response.ok) {
							throw new Error('Không thể tải file JSON. Trạng thái: ' + response.status);
						}
						return response.json();
					})
					.then(data => {
						renderMenu(data.categories);
						// Khôi phục lại sự kiện click sau khi đã render menu
						setupDropMenuEvent();
					})
					.catch(error => {
						console.error('Lỗi khi tải dữ liệu menu:', error);
					});
			}

			// Hàm thiết lập sự kiện cho nút drop-menu
			function setupDropMenuEvent() {
				// Đảm bảo chỉ gắn sự kiện một lần
				$('#drop-menu').off('click').on('click', function () {
					$('#nav-mobile').toggleClass('red_highlight', 'no_highlight');
				});
			}

			// Hàm render menu dựa trên cấu trúc HTML hiện tại
			function renderMenu(categories) {
				const navMobile = document.getElementById('nav-mobile');
				if (!navMobile) return;

				// Lưu trạng thái class hiện tại
				const hasRedHighlight = navMobile.classList.contains('red_highlight');

				navMobile.innerHTML = ''; // Xóa menu cũ

				// Khôi phục class red_highlight nếu có
				if (hasRedHighlight) {
					navMobile.classList.add('red_highlight');
				}

				categories.forEach(category => {
					const li = document.createElement('li');
					li.className = '';

					const a = document.createElement('a');
					a.href = category.url;
					a.textContent = category.name;

					li.appendChild(a);
					navMobile.appendChild(li);
				});
			}

			// Gọi hàm tải dữ liệu
			loadMenuData();
		});
	</script>

	<header class="fixd-mobile large--hide">
		<div id="site-mobile" class="large--hide ">
			<div class="wrapper">
				<div class="inner">
					<div class="grid">
						<div class="grid__item medium--two-twelfths small--two-twelfths">
							<div class="site-nav--mobile">
								<button type="button" class="icon-fallback-text site-nav__link js-drawer-open-left"
									aria-controls="NavDrawer" aria-expanded="false">
									<i class="fa fa-bars" aria-hidden="true"></i>
								</button>
							</div>
						</div>
						<div class="grid__item medium--eight-twelfths small--eight-twelfths pd-left0 hd-searchbar">
							<form action="./collections/search.html" method="get"
								class="input-group search-bar home-search-bar" role="search">
								<input type="hidden" name="type" value="product">
								<input type="search" name="q" value="" placeholder="Tìm kiếm..."
									class="input-group-field" aria-label="Tìm kiếm...">
								<span class="input-group-btn">
									<button type="submit" class="btn icon-fallback-text">
										<span class="icon icon-search" aria-hidden="true"></span>
										<span class="fallback-text">Tìm kiếm</span>
									</button>
								</span>
							</form>

						</div>
						<div class="grid__item medium--two-twelfths small--two-twelfths text-right">
							<div class="site-nav--mobile cart-site">
								<a href="../cart.html" class="js-drawer-open-right site-nav__link text-center"
									aria-controls="CartDrawer" aria-expanded="false">
									<span class="icon-fallback-text">
										<i class="fa fa-shopping-cart" aria-hidden="true"></i>
									</span>
								</a>
							</div>
						</div>
						<div class="grid__item medium--one-whole small--one-whole">
							<div class="fix-hd">
								<a href="tel:093 1387 046">
									<i class="fa fa-phone" aria-hidden="true"></i>
									<span>093 1387 046</span>
								</a>
								<a href="pages/he-thong-cua-hang.html">
									<i class="fa fa-building" aria-hidden="true"></i>
									<span>Hệ thống <b>5</b> cửa hàng</span>
								</a>

							</div>
						</div>
						<div class="grid__item medium--one-whole small--one-whole pd-left0">
							<div id="site-header">
								<div id="topmenu">
									<div class="hd-navbar">
										<ul id="nav-mobile" class="no-bullets">

										</ul>
										<span id="drop-menu" class="icon-drop">
											<i class="fa fa-angle-double-down"></i>
										</span>
									</div>
								</div>
							</div>
							<script>
								$(document).ready(function () {

									$('#drop-menu').on('click', function () {
										$('#nav-mobile').toggleClass('red_highlight', 'no_highlight');
									});
								});

							</script>
						</div>
					</div>
				</div>
			</div>
		</div>
	</header>


	<section id="breadcrumb-wrapper" class="breadcrumb-w-img">
		<div class="breadcrumb-overlay"></div>
		<div class="breadcrumb-content">
			<div class="wrapper">
				<div class="inner text-center">
					<div class="breadcrumb-big">

						<h2>
							Giỏ hàng của bạn - Bánh Mì Chảo Thương Nhớ
						</h2>

					</div>

				</div>
			</div>
		</div>
	</section>



	<div id="PageContainer" class="is-moved-by-drawer">
		<main class="main-content" role="main">
			<div id="page-wrapper">
				<div class="wrapper">
					<div class="inner">
						<!-- Phần này sẽ được script tự động điền nội dung -->
						<h2>Giỏ hàng</h2>
						<p>Giỏ hàng trống</p>
						<p>Tiếp tục mua hàng <a href="index.html">tại đây</a>.</p>

					</div>
				</div>
			</div>
		</main>
	</div>

	<!-- cập nhật đơn hàng không có api map -->
	<!-- <script>
		jQuery(function ($) {
			function extractPrice(priceString) {
				return parseInt(priceString.replace(/[^0-9]/g, ""), 10) || 0;
			}

			function formatMoney(amount) {
				return amount.toLocaleString() + '₫';
			}

			function generateUniqueId() {
				return Date.now() + '-' +
					Math.random().toString(36).substr(2, 9) + '-' +
					Math.floor(Math.random() * 100000) + '-' +
					JSON.stringify(Math.random());
			}
			function updateCartCount() {
				let cart = JSON.parse(localStorage.getItem('cart')) || [];
				let itemCount = cart.length;
				$('#CartCount').text(itemCount);
			}
			$(document).ready(function () {
				updateCartCount();
			});

			function renderCartPage() {
				let cart = JSON.parse(localStorage.getItem('cart')) || [];
				// Đảm bảo mỗi sản phẩm đều có id
				cart = cart.map(item => {
					if (!item.id) {
						item.id = generateUniqueId();
					}
					return item;
				});

				// Lưu lại cart với id
				localStorage.setItem('cart', JSON.stringify(cart));
				let $cartWrapper = $('#PageContainer .inner');
				let totalCost = 0;
				// Nếu giỏ hàng rỗng
				if (cart.length === 0) {
					$cartWrapper.html(`
                <h2>Giỏ hàng</h2>
                <p>Giỏ hàng trống</p>
                <p>Tiếp tục mua hàng <a href="index.html">tại đây</a>.</p>
            `);
					return;
				}

				// Tạo bảng sản phẩm
				let cartTableHtml = `
            <h2>Giỏ hàng</h2>
            <table class="cart-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 8px;">Hình ảnh</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Sản phẩm</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Topping</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Tổng Tiền</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    ${cart.map((item) => {
					let toppingsTotal = item.selectedToppings.reduce((total, topping) =>
						total + (topping.toppingPrice * topping.toppingQuantity), 0);
					let itemTotal = item.productPrice;
					let image = item.productImage;
					if (image.includes("../image_food/")) {
						// Nếu có, thay thế "../image_food/" bằng "./image_food/"
						image = image.replace("../image_food/", "./image_food/");
					}
					totalCost += itemTotal;
					let toppingsHtml = item.selectedToppings.map(topping =>
						`${topping.toppingName} (SL: ${topping.toppingQuantity}) - ${formatMoney(topping.toppingPrice * topping.toppingQuantity)}`
					).join('<br>');

					return `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                    <img src="${image}" alt="${item.productName}" style="max-width: 100px; max-height: 100px;">

                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px;">
                                    ${item.productName} - ${formatMoney((item.productPrice - toppingsTotal) / (item.productQuantity))} <br> Số Lượng: ${item.productQuantity} <br> Thành Tiền: ${formatMoney(item.productPrice - toppingsTotal)}
                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px;">
                                    ${toppingsHtml || 'Không có topping'}
                                </td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${formatMoney(itemTotal)}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">
                                    <button class="remove-item" data-id="${item.id}" style="color: red; border: none; background: none; cursor: pointer;">Xóa</button>
                                </td>
                            </tr>
                        `;
				}).join('')}
                </tbody>
            </table>

            <div class="cart-summary" style="margin-top: 20px;">
                <p><strong>Tổng giá:</strong> ${formatMoney(totalCost)}</p>
				<p>Tiếp tục mua hàng <a href="index.html">tại đây</a>.</p>
                <button id="checkout-btn" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer;">Đặt hàng</button>
            </div>

			
			<div id="checkout-popup" style="
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background-color: rgba(0,0,0,0.5); 
    z-index: 1000;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
">
    <div style="
        background-color: white; 
        padding: 20px; 
        border-radius: 10px; 
        width: 90%; 
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
    ">
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Thông tin đặt hàng</h2>
            </div>
            
            <div class="section-content section-customer-information">
                <div class="fieldset">
                    <div style="display: flex; gap: 15px;">
                        <div class="field field-two-thirds">
                            <div class="field-input-wrapper">
                                <label class="field-label" for="popup_billing_address_full_name">Họ và tên</label>
								<input 
									placeholder="Họ và tên" 
									autocapitalize="off" 
									spellcheck="false" 
									class="field-input" 
									type="text" 
									id="popup_billing_address_full_name" 
									name="billing_address[full_name]"
									style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
								>
                            </div>
                        </div>
                        <div class="field field-third">
                            <div class="field-input-wrapper">
                                <label class="field-label" for="popup_billing_address_phone">Điện thoại</label>
                                <input 
                                    placeholder="Điện thoại" 
                                    autocapitalize="off" 
                                    spellcheck="false" 
                                    class="field-input" 
                                    type="tel" 
                                    id="popup_billing_address_phone" 
                                    name="billing_address[phone]"
                                    style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="shipping-method" style="margin-top: 15px;">
                        <div style="display: flex; align-items: center;">
                            <label style="margin-right: 15px;">
                                <input 
                                    type="radio" 
                                    name="customer_pick_at_location" 
                                    value="false" 
                                    checked
                                > 
                                Giao hàng
                            </label>
                            <label>
                                <input 
                                    type="radio" 
                                    name="customer_pick_at_location" 
                                    value="true"
                                > 
                                Nhận tại cửa hàng
                            </label>
                        </div>

                        <div id="delivery-details" style="margin-top: 15px;">
                            <input 
                                type="text" 
                                placeholder="Địa chỉ" 
                                style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
                            >

                            <div style="display: flex; gap: 10px;">
                                <select style="width: 33%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option>Tỉnh thành</option>
                                    <option>Hà Nội</option>
                                </select>

                                <select style="width: 33%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option>Quận/Huyện</option>
                                </select>
								<select style="width: 33%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option>Phường/Xã</option>
                                </select>
                            </div>
                        </div>

                        <div id="pickup-details" style="display: none; color: gray; margin-top: 15px;">
                            Không tìm thấy thông tin cửa hàng
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
            <button id="close-popup" style="
                background-color: #f44336; 
                color: white; 
                border: none; 
                padding: 10px 20px; 
                margin-right: 10px; 
                border-radius: 4px;
            ">Đóng</button>
            <button id="confirm-payment" style="
                background-color: #4CAF50; 
                color: white; 
                border: none; 
                padding: 10px 20px; 
                border-radius: 4px;
            ">Đặt hàng</button>
        </div>
    </div>
</div>
        `;

				const locationData = {
					'Hà Nội': {
						'Quận Ba Đình': ['Phường Phúc Xá', 'Phường Trúc Bạch', 'Phường Vĩnh Phúc', 'Phường Cống Vị', 'Phường Liễu Giai', 'Phường Quán Thánh', 'Phường Ngọc Hà', 'Phường Điện Biên', 'Phường Đội Cấn', 'Phường Ngọc Khánh', 'Phường Kim Mã', 'Phường Giảng Võ', 'Phường Thành Công'],
						'Quận Hoàn Kiếm': ['Phường Phúc Tân', 'Phường Đồng Xuân', 'Phường Hàng Mã', 'Phường Hàng Buồm', 'Phường Hàng Đào', 'Phường Hàng Bồ', 'Phường Cửa Đông', 'Phường Lý Thái Tổ', 'Phường Hàng Bạc', 'Phường Hàng Gai', 'Phường Chương Dương', 'Phường Hàng Trống', 'Phường Cửa Nam', 'Phường Hàng Bông', 'Phường Tràng Tiền', 'Phường Trần Hưng Đạo', 'Phường Phan Chu Chinh', 'Phường Hàng Bài',],
						'Quận Tây Hồ': ['Phường Phú Thượng', 'Phường Nhật Tân', 'Phường Tứ Liên', 'Phường Quảng An', 'Phường Xuân La', 'Phường Yên Phụ', 'Phường Bưởi', 'Phường Thụy Khuê'],
						'Quận Long Biên': ['Phường Thượng Thanh', 'Phường Ngọc Thụy', 'Phường Giang Biên', 'Phường Đức Giang', 'Phường Việt Hưng', 'Phường Gia Thụy', 'Phường Ngọc Lâm', 'Phường Phúc Lợi', 'Phường Bồ Đề', 'Phường Long Biên', 'Phường Thạch Bàn', 'Phường Phúc Đồng', 'Phường Cự Khối'],
						'Quận Cầu Giấy': ['Phường Nghĩa Đô', 'Phường Nghĩa Tân', 'Phường Mai Dịch', 'Phường Dịch Vọng', 'Phường Dịch Vọng Hậu', 'Phường Quan Hoa', 'Phường Yên Hòa', 'Phường Trung Hòa'],
						'Quận Đống Đa': ['Phường Cát Linh', 'Phường Văn Miếu - Quốc Tử Giám', 'Phường Láng Thượng', 'Phường Ô Chợ Dừa', 'Phường Văn Chương', 'Phường Hàng Bột', 'Phường Láng Hạ', 'Phường Khâm Thiên', 'Phường Thổ Quan', 'Phường Nam Đồng', 'Phường Quang Trung', 'Phường Trung Liệt', 'Phường Phương Liệt - Trung Tự', 'Phường Kim Liên', 'Phường Phương Mai', 'Phường Thịnh Quang', 'Phường Khương Thượng'],
						'Quận Hai Bà Trưng': ['Phường Nguyễn Du', 'Phường Bạch Đằng', 'Phường Phạm Đình Hổ', 'Phường Lê Đại Hành', 'Phường Đồng Nhân', 'Phường Phố Huế', 'Phường Thanh Lương', 'Phường Thanh Nhàn', 'Phường Bách KHoa', 'Phường Đồng Tâm', 'Phường Vĩnh Tuy', 'Phường Quỳnh Mai', 'Phường Bạch Mai', 'Phường Minh Khai', 'Phường Trương Định'],
						'Quận Hoàng Mai': ['Phường Thanh Trì', 'Phường Vĩnh Hưng', 'Phường Định Công', 'Phường Mai Động', 'Phường Tương Mai', 'Phường Đại Kim', 'Phường Tân Mai', 'Phường Hoàng Văn Thụ', 'Phường Giáp Bát', 'Phường Lĩnh Nam', 'Phường Thịnh Liệt', 'Phường Trần Phú', 'Phường Hoàng Liệt', 'Phường Yên Sở'],
						'Quận Thanh Xuân': ['Phường Nhân Chính', 'Phường Thượng Đình', 'Phường Khương Trung', 'Phường Khương Mai', 'Phường Thanh Xuân Trung', 'Phường Phương Liệt', 'Phường Khương Đình', 'Phường Thanh Xuân Bắc', 'Phường Hạ Đình'],
						'Huyện Sóc Sơn': ['Thị trấn Sóc Sơn', 'Xã Bắc Sơn', 'Xã Minh Trí', 'Xã Hồng Kỳ', 'Xã Nam Sơn', 'Xã Trung Giã', 'Xã Tân Hưng', 'Xã Minh Phú', 'Xã Phù Linh', 'Xã Bắc Phú', 'Xã Tân Minh', 'Xã Quang Tiến', 'Xã Hiền Ninh', 'Xã Tân Dân', 'Xã Tiên Dược', 'Xã Việt Long', 'Xã Xuân Giang', 'Xã Mai Đình', 'Xã Đức Hoà', 'Xã Thanh Xuân', 'Xã Đông Xuân', 'Xã Kim Lũ', 'Xã Phú Cường', 'Xã Phú Minh', 'Xã Phù Lỗ', 'Xã Xuân Thu'],
						'Huyện Đông Anh': ['Thị trấn Đông Anh', 'Xã Xuân Nộn', 'Xã Thụy Lâm', 'Xã Bắc Hồng', 'Xã Nguyên Khê', 'Xã Nam Hồng', 'Xã Tiên Dương', 'Xã Vân Hà', 'Xã Uy Nỗ', 'Xã Vân Nội', 'Xã Liên Hà', 'Xã Việt Hùng', 'Xã Kim Nỗ', 'Xã Kim Chung', 'Xã Dục Tú', 'Xã Đại Mạch', 'Xã Vĩnh Ngọc', 'Xã Cổ Loa', 'Xã Hải Bối', 'Xã Xuân Canh', 'Xã Vọng La', 'Xã Tàm Xá', 'Xã Mai Lâm', 'Xã Đông Hội'],
						'Huyện Gia Lâm': ['Thị trấn Yên Viên', 'Xã Yên Thường', 'Xã Yên Viên', 'Xã Ninh Hiệp', 'Xã Thiên Đức', 'Xã Phù Đổng', 'Xã Lệ Chi', 'Xã Cổ Bi', 'Xã Đặng Xá', 'Xã Phú Sơn', 'Thị trấn Trâu Quỳ', 'Xã Dương Quang', 'Xã Dương Xá', 'Xã Đa Tốn', 'Xã Kiêu Kỵ', 'Xã Bát Tràng', 'Xã Kim Đức'],
						'Quận Nam Từ Liêm': ['Phường Cầu Diễn', 'Phường Xuân Phương', 'Phường Phương Canh', 'Phường Mỹ Đình 1', 'Phường Mỹ Đình 2', 'Phường Tây Mỗ', 'Phường Mễ Trì', 'Phường Phú Đô', 'Phường Đại Mỗ', 'Phường Trung Văn'],
						'Huyện Thanh Trì': ['Thị trấn Văn Điển', 'Xã Tân Triều', 'Xã Thanh Liệt', 'Xã Tả Thanh Oai', 'Xã Hữu Hòa', 'Xã Tam Hiệp', 'Xã Tứ Hiệp', 'Xã Yên Mỹ', 'Xã Vĩnh Quỳnh', 'Xã Ngũ Hiệp', 'Xã Duyên Hà', 'Xã Ngọc Hồi', 'Xã Vạn Phúc', 'Xã Đại Áng', 'Xã Liên Ninh', 'Xã Đông Mỹ'],
						'Quận Bắc Từ Liêm': ['Phường Thượng Cát', 'Phường Liên Mạc', 'Phường Đông Ngạc', 'Phường Đức Thắng', 'Phường Thụy Phương', 'Phường Tây Tựu', 'Phường Xuân Đỉnh', 'Phường Xuân Tảo', 'Phường Minh Khai', 'Phường Cổ Nhuế 1', 'Phường Cổ Nhuế 2', 'Phường Phú Diễn', 'Phường Phúc Diễn'],
						'Huyện Mê Linh': ['Thị trấn Chi Đông', 'Xã Đại Thịnh', 'Xã Kim Hoa', 'Xã Thạch Đà', 'Xã Tiến Thắng', 'Xã Tự Lập', 'Thị trấn Quang Minh', 'Xã Thanh Lâm', 'Xã Tam Đồng', 'Xã Liên Mạc', 'Xã Chu Phan', 'Xã Tiến Thịnh', 'Xã Mê Linh', 'Xã Văn Khê', 'Xã Hoàng Kim', 'Xã Tiền Phong', 'Xã Tráng Việt'],
						'Quận Hà Đông': ['Phường Quang Trung', 'Phường Mộ Lao', 'Phường Văn Quán', 'Phường Văn Phúc', 'Phường La Khê', 'Phường Phú La', 'Phường Phúc La', 'Phường Hà Cầu', 'Phường Yên Nghĩa', 'Phường Kiến Hưng', 'Phường Phú Lãm', 'Phường Phú Lương', 'Phường Dương Nội', 'Phường Đồng Mai', 'Phường Biên Giang'],
						'Thị xã Sơn Tây': ['Phường Ngô Quyền', 'Phường Phú Thịnh', 'Phường Sơn Lộc', 'Phường Xuân Khanh', 'Xã Đường Lâm', 'Phường Viên Sơn', 'Xã Xuân Sơn', 'Phường Trung Hưng', 'Xã Thanh Mỹ', 'Phường Trung Sơn Trầm', 'Xã Kim Sơn', 'Xã Sơn Đông', 'Xã Cổ Đông'],
						'Huyện Ba Vì': ['Thị trấn Tây Đằng', 'Xã Phú Cường', 'Xã Cổ Đô', 'Xã Vạn Thắng', 'Xã Phong Vân', 'Xã Phú Đông', 'Xã Phú Hồng', 'Xã Phú Châu', 'Xã Thái Hòa', 'Xã Đồng Thái', 'Xã Phú Sơn', 'Xã Minh Châu', 'Xã Vật Lại', 'Xã Chu Minh', 'Xã Tòng Bạt', 'Xã Cẩm Lĩnh', 'Xã Sơn Đà', 'Xã Đồng Quang', 'Xã Tiên Phong', 'Xã Thụy An', 'Xã Cẩm Thượng', 'Xã Thuần Mỹ', 'Xã Tản Lĩnh', 'Xã Ba Trại', 'Xã Minh Quang', 'Xã Ba Vì', 'Xã Vân Hòa', 'Xã Yên Bài', 'Xã Khánh Thượng'],
						'Huyện Phúc Thọ': ['Thị trấn Phúc Thọ', 'Xã Vân Phúc', 'Xã Nam Hà', 'Xã Xuân Đình', 'Xã Sen Phương', 'Xã Vọng Xuyên', 'Xã Tích Lộc', 'Xã Long Thượng', 'Xã Hát Môn', 'Xã Thanh Đa', 'Xã Trạch Mỹ Lộc', 'Xã Phúc Hòa', 'Xã Ngọc Tảo', 'Xã Phụng Thượng', 'Xã Tam Thuấn', 'Xã Tam Hiệp', 'Xã Hiệp Thuận', 'Xã Liên Hiệp'],
						'Huyện Đan Phượng': ['Thị trấn Phùng', 'Xã Trung Châu', 'Xã Thọ An', 'Xã Thọ Xuân', 'Xã Hồng Hà', 'Xã Liên Hồng', 'Xã Liên Hà', 'Xã Hạ Mỗ', 'Xã Liên Trung', 'Xã Phương Đình', 'Xã Thượng Mỗ', 'Xã Tân Hội', 'Xã Tân Lập', 'Xã Đan Phượng', 'Xã Đồng Tháp', 'Xã Song Phượng'],
						'Huyện Hoài Đức': ['Thị trấn Trạm Trôi', 'Xã Đức Thượng', 'Xã Minh Khai', 'Xã Dương Liễu', 'Xã Di Trạch', 'Xã Đức Giang', 'Xã Cát Quế', 'Xã Kim Chung', 'Xã Yên Sở', 'Xã Sơn Đồng', 'Xã Vân Canh', 'Xã Đắc Sở', 'Xã Lai Yên', 'Xã Tiền Yên', 'Xã Song Phương', 'Xã An Khánh', 'Xã An Thượng', 'Xã Vân Côn', 'Xã La Phù', 'Xã Đông La'],
						'Huyện Quốc Oai': ['Xã Đông Xuân', 'Thị trấn Quốc Oai', 'Xã Sài Sơn', 'Xã Phượng Sơn', 'Xã Ngọc Liệp', 'Xã Ngọc Mỹ', 'Xã Thạch Thán', 'Xã Đông Quang', 'Xã Phú Cát', 'Xã Tuyết Nghĩa', 'Xã Liệp Nghĩa', 'Xã Cộng Hòa', 'Xã Hùng Đô', 'Xã Phú Mãn', 'Xã Cấn Hữu', 'Xã Hòa Thạch', 'Xã Đồng Yên'],
						'Huyện Thạch Thất': ['Xã Yên Trung', 'Xã Yên Bình', 'Xã Tiến Xuân', 'Thị trấn Liên Quan', 'Xã Đại Đồng', 'Xã Cẩm Yên', 'Xã Lại Thượng', 'Xã Phú Kim', 'Xã Hương Ngải', 'Xã Lam Sơn', 'Xã Kim Quan', 'Xã Bình Yên', 'Xã Thạch Hòa', 'Xã Cần Kiệm', 'Xã Phùng Xá', 'Xã Tân Xá', 'Xã Thạch Xá', 'Xã Quang Trung', 'Xã Hạ Bằng', 'Xã Đồng Trúc'],
						'Huyện Chương Mỹ': ['Thị trấn Chúc Sơn', 'Thị trấn Xuân Mai', 'Xã Phụng Châu', 'Xã Tiên Phương', 'Xã Đồng Sơn', 'Xã Đông Phương Yên', 'Xã Phú Nghĩa', 'Xã Trường Yên', 'Xã Ngọc Hòa', 'Xã Thủy Xuân Tiên', 'Xã Thanh Bình', 'Xã Trường Hòa', 'Xã Đại Yên', 'Xã Thụy Hương', 'Xã Tốt Động', 'Xã Lam Điền', 'Xã Tân Tiến', 'Xã Nam Phương Tiến', 'Xã Hợp Đồng', 'Xã Hoàng Văn Thụ', 'Xã Hoàng Diệu', 'Xã Hữu Văn', 'Xã Mỹ Lương', 'Xã Thượng Vực', 'Xã Hồng Phong', 'Xã Trần Phú', 'Xã Quảng Bị', 'Xã Văn Võ', 'Xã Đồng Lạc', 'Xã Hòa Phú'],
						'Huyện Thanh Oai': ['Thị trấn Kim Bài', 'Xã Cự Khê', 'Xã Bích Hòa', 'Xã Mỹ Hưng', 'Xã Cao Viên', 'Xã Bình Minh', 'Xã Tam Hưng', 'Xã Thanh Cao', 'Xã Thanh Thùy', 'Xã Thanh Mai', 'Xã Thanh Văn', 'Xã Đỗ Động', 'Xã Kim An', 'Xã Kim Thư', 'Xã Phương Trung', 'Xã Tân Ước', 'Xã Dân Hòa', 'Xã Liên Châu', 'Xã Cao Xuân Dương', 'Xã Hồng Dương'],
						'Huyện Thường Tín': ['Thị trấn Thường Tín', 'Xã Ninh Sở', 'Xã Nhị Khê', 'Xã Duyên Thái', 'Xã Khánh Hà', 'Xã Hòa Bình', 'Xã Văn Bình', 'Xã Hiền Giang', 'Xã Hồng Vân', 'Xã Vân Tảo', 'Xã Liên Phương', 'Xã Văn Phú', 'Xã Tự Nhiên', 'Xã Tiền Phong', 'Xã Hải Hồi', 'Xã Nguyễn Trãi', 'Xã Quất Động', 'Xã Chương Dương', 'Xã Tân Minh', 'Xã Lê Lợi', 'Xã Thắng Lợi', 'Xã Dũng Tiến', 'Xã Nghiêm Xuyên', 'Xã Tô Hiệu', 'Xã Văn Tự', 'Xã Vạn Điểm', 'Xã Minh Cường'],
						'Huyện Phú Xuyên': ['Thị trấn Phú Minh', 'Thị trấn Phú Xuyên', 'Xã Hồng Minh', 'Xã Phượng Dực', 'Xã Nam Tiến', 'Xã Nam Phong', 'Xã Tân Dân', 'Xã Quang Hán', 'Xã Chuyên Mỹ', 'Xã Khai Thái', 'Xã Phúc Tiến', 'Xã Vân Từ', 'Xã Tri Thủy', 'Xã Đại Xuyên', 'Xã Phú Yên', 'Xã Bạch Hạ', 'Xã Quang Lãng', 'Xã Châu Can', 'Xã Minh Tân'],
						'Huyện Ứng Hòa': ['Thị trấn Vân Đình', 'Xã Hoa Viên', 'Xã Quảng Phú Cầu', 'Xã Trường Thịnh', 'Xã Liên Bạt', 'Xã Cao Sơn Tiến', 'Xã Phương Tú', 'Xã Trung Tú', 'Xã Đồng Tân', 'Xã Tảo Dương Văn', 'Xã Thái Hòa', 'Xã Minh Đức', 'Xã Trầm Lộng', 'Xã Kim Đường', 'Xã Hòa Phú', 'Xã Đại Hùng', 'Xã Đồng Lỗ', 'Xã Phù Lưu', 'Xã Đại Cường', 'Xã Bình Lưu Quang'],
						'Huyện Mỹ Đức': ['Thị trấn Đại Nghĩa', 'Xã Đồng Tâm', 'Xã Thượng Lâm', 'Xã Tuy Lai', 'Xã Phúc Lâm', 'Xã Mỹ Xuyên', 'Xã An Mỹ', 'Xã Hồng Sơn', 'Xã Lê Thanh', 'Xã Xuy Xá', 'Xã Phùng Xá', 'Xã Phù Lưu Tế', 'Xã Đại Hưng', 'Xã Vạn Tín', 'Xã Hương Sơn', 'Xã Hùng Tiến', 'Xã An Tiến', 'Xã Hợp Tiến', 'Xã Hợp Thanh', 'Xã An Phú']
					}
				};
				const storeLocations = [
					{
						name: "Bánh Mì Chảo Thương Nhớ CS1",
						address: "Số 51 ngõ 14 Mễ Trì Hạ - Nam Từ Liêm - Hà Nội",
						mapLink: "https://maps.app.goo.gl/bzA4bbJAthbHPtsG8",
						phone: "0327 691 700 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS2",
						address: "Số 17 Ngõ 63 Vũ Trọng Phung - Thanh Xuân -Hà Nội",
						mapLink: "https://maps.app.goo.gl/gWxpnB3kEiL4iYnQ7",
						phone: "0869 538 034 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS3",
						address: "Số 1 Ngách 17C Ngõ 35 Trần Thái Tông, Cầu Giấy",
						mapLink: "https://maps.app.goo.gl/DwDubeksMkqfdUu37",
						phone: "0843 163 863 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS4",
						address: "Số 110 P. Trung Liệt, Trung Liệt, Đống Đa, Hà Nội, Việt Nam",
						mapLink: "https://maps.app.goo.gl/bC2dna4EdWbGaafu8",
						phone: "0379 466 682 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS5",
						address: "Số 100 Phạm Huy Thông - Ngoc Khánh - Ba Đình - Hà Nội",
						mapLink: "https://maps.app.goo.gl/CmzQXUwUaGKTZQeK7",
						phone: "035 507 0658 - 093 1387 046"
					}
				];
				$(document).ready(function () {
					const $provinceSelect = $('select:nth-child(1)');
					const $districtSelect = $('select:nth-child(2)');
					const $wardSelect = $('select:nth-child(3)');

					// Cập nhật Quận/Huyện khi chọn Tỉnh/Thành
					$provinceSelect.on('change', function () {
						const selectedProvince = $(this).val();

						// Xóa các option cũ của Quận/Huyện
						$districtSelect.empty().append('<option>Quận/Huyện</option>');
						$wardSelect.empty().append('<option>Phường/Xã</option>');

						// Thêm Quận/Huyện của tỉnh được chọn
						if (locationData[selectedProvince]) {
							Object.keys(locationData[selectedProvince]).forEach(district => {
								$districtSelect.append(`<option value="${district}">${district}</option>`);
							});
						}
					});

					// Cập nhật Phường/Xã khi chọn Quận/Huyện
					$districtSelect.on('change', function () {
						const selectedProvince = $provinceSelect.val();
						const selectedDistrict = $(this).val();

						// Xóa các option cũ của Phường/Xã
						$wardSelect.empty().append('<option>Phường/Xã</option>');

						// Thêm Phường/Xã của Quận/Huyện được chọn
						if (locationData[selectedProvince] && locationData[selectedProvince][selectedDistrict]) {
							locationData[selectedProvince][selectedDistrict].forEach(ward => {
								$wardSelect.append(`<option value="${ward}">${ward}</option>`);
							});
						}
					});
				});
				$cartWrapper.html(cartTableHtml);

				// Xử lý xóa sản phẩm
				$('#PageContainer .remove-item').on('click', function () {
					let productId = $(this).data('id');
					let cart = JSON.parse(localStorage.getItem('cart')) || [];

					// Lọc ra các sản phẩm không có ID được chọn
					cart = cart.filter(item => item.id !== productId);
					localStorage.setItem('cart', JSON.stringify(cart));

					// Thêm dòng này để cập nhật số lượng
					updateCartCount();
					renderCartPage();
				});

				// Xử lý thanh toán
				$('#PageContainer #checkout-btn').off('click').on('click', function () {
					// Di chuyển popup ra ngoài PageContainer để hiển thị toàn màn hình
					$('body').append($('#checkout-popup'));
					$('#checkout-popup').css({
						'display': 'flex',
						'position': 'fixed',
						'top': '0',
						'left': '0',
						'width': '100%',
						'height': '100%',
						'background-color': 'rgba(0,0,0,0.5)',
						'z-index': '9999',
						'justify-content': 'center',
						'align-items': 'center'
					});
				});

				// Xử lý đóng popup
				$('#close-popup').off('click').on('click', function () {
					$('#checkout-popup').hide();
				});

				// Xử lý radio button giao hàng/nhận tại cửa hàng
				$('input[name="customer_pick_at_location"]').off('change').on('change', function () {
					if ($(this).val() === 'false') {
						$('#delivery-details').show();
						$('#pickup-details').hide();
					} else {
						$('#delivery-details').hide();
						$('#pickup-details').empty(); // Xóa nội dung cũ

						// Tạo danh sách cửa hàng với chức năng chọn
						let storeListHtml = `
    <h3>Danh sách cửa hàng</h3>
    <div class="store-list" style="margin-top: 10px;">
        ${storeLocations.map((store, index) => `
            <div class="store-item" data-store-id="${store.name}" style="
                border: 1px solid #ddd; 
                padding: 10px; 
                margin-bottom: 10px; 
                border-radius: 5px;
                position: relative;
                cursor: pointer;
            ">
                <input 
                    type="radio" 
                    id="store-${index}" 
                    name="selected_store" 
                    value="${store.name}" 
                    style="display: none;"
                >
                <label for="store-${index}" style="display: block; cursor: pointer;">
                    <h4 style="margin: 0 0 10px 0;">${store.name}</h4>
                    <p style="margin: 5px 0;"><strong>Địa chỉ:</strong> ${store.address}</p>
                    <p style="margin: 5px 0;"><strong>Điện thoại:</strong> ${store.phone}</p>
                </label>
                <div style="margin-top: 10px;">
                    <a href="${store.mapLink}" target="_blank" style="
                        background-color: #4CAF50; 
                        color: white; 
                        padding: 5px 10px; 
                        text-decoration: none; 
                        border-radius: 3px;
                        display: inline-block;
                    ">Xem vị trí trên bản đồ</a>
                </div>
            </div>
        `).join('')}
    </div>
`;

						// Thêm sự kiện click cho toàn bộ store-item
						$(document).on('click', '.store-item', function (e) {
							// Ngăn chặn sự kiện click trên liên kết bản đồ
							if ($(e.target).closest('a').length) return;

							// Chọn radio button tương ứng
							$(this).find('input[type="radio"]').prop('checked', true);

							// Loại bỏ viền của tất cả các store-item
							$('.store-item').css('border', '1px solid #ddd');

							// Thêm viền cho store-item được chọn
							$(this).css('border', '2px solid #4CAF50');

							// Xóa viền đỏ của danh sách store
							$('.store-list').css('border', 'none');
						});

						$('#pickup-details')
							.html(storeListHtml)
							.show();
					}
				});

				// Chỉ gán sự kiện một lần cho nút xác nhận thanh toán

				$(document).ready(function () {
					$('#confirm-payment').off('click').on('click', function () {
						let isValid = true;

						// Xóa cảnh báo cũ
						$('.field-input, select').removeClass('error-input');

						let fullName = $('#popup_billing_address_full_name');
						let phone = $('#popup_billing_address_phone');
						let isPickup = $('input[name="customer_pick_at_location"]:checked').val() === 'true';

						// Kiểm tra tên
						if (fullName.val().trim() === '') {
							showError(fullName, 'Vui lòng nhập họ và tên!');
							isValid = false;
						}

						// Kiểm tra số điện thoại
						if (phone.val().trim() === '') {
							showError(phone, 'Vui lòng nhập số điện thoại!');
							isValid = false;
						} else if (!/^\d{10,11}$/.test(phone.val().trim())) {
							// Kiểm tra nếu số điện thoại không phải 10-11 chữ số
							showError(phone, 'Số điện thoại không hợp lệ');
							isValid = false;
						}

						if (!isPickup) {
							// Kiểm tra thông tin giao hàng
							let address = $('#delivery-details input[type="text"]');
							let province = $('#delivery-details select:eq(0)');
							let district = $('#delivery-details select:eq(1)');
							let ward = $('#delivery-details select:eq(2)');

							// Hàm kiểm tra và hiện lỗi nếu cần
							function validateField(element, emptyValue, message) {
								if (element.val().trim() === emptyValue) {
									showError(element, message);
									isValid = false;
								}
							}

							// Thực hiện kiểm tra input và dropdown
							validateField(address, '', 'Vui lòng nhập địa chỉ!');
							if (province.val() === 'Tỉnh thành') {
								showErrorDropdown(province, 'Chọn tỉnh!');
								isValid = false;
							}
							if (district.val() === 'Quận/Huyện') {
								showErrorDropdown(district, 'Chọn quận/huyện!');
								isValid = false;
							}
							if (ward.val() === 'Phường/Xã') {
								showErrorDropdown(ward, 'Chọn phường/xã!');
								isValid = false;
							}
						}
						else {
							// Kiểm tra cửa hàng được chọn khi là pickup
							let selectedStore = $('input[name="selected_store"]:checked').val();

							if (!selectedStore) {
								$('.store-list').css('border', '2px solid red');
								isValid = false;
							} else {
								$('.store-list').css('border', 'none');
							}

							// Sự kiện click cho từng store item
							$('.store-item').on('click', function () {
								$('.store-item').css('border', '1px solid #ddd');
								$(this).css('border', '2px solid #4CAF50');
								$('.store-list').css('border', 'none');
							});
						}

						if (isValid) {
							$('#checkout-popup').hide();
							createOrderSummary();
							localStorage.removeItem('cart');  // Xóa toàn bộ sản phẩm trong giỏ hàng từ localStorage
							window.location.href = './'; // Chuyển về trang chủ
						}
					});
					function normalizeImagePath(path) {
						if (path.startsWith('../')) {
							return path;
						} else if (path.startsWith('./')) {
							return '../' + path.substring(2);
						} else {
							return '../' + path;
						}
					}
					// Đóng popup
					$('#close-popup').on('click', function () {
						$('#checkout-popup').hide();
					});

					//tính tổng tiền
					function createOrderSummary() {
						// Kiểm tra các phần tử trước khi truy xuất
						const fullNameEl = document.getElementById('popup_billing_address_full_name');
						const phoneNumberEl = document.getElementById('popup_billing_address_phone');
						const deliveryOptions = document.getElementsByName('customer_pick_at_location');

						// Kiểm tra null
						if (!fullNameEl || !phoneNumberEl) {
							console.error('Không tìm thấy phần tử thông tin khách hàng');
							return false;
						}

						const fullName = fullNameEl.value.trim();
						const phoneNumber = phoneNumberEl.value.trim();

						// Kiểm tra giá trị
						if (!fullName || !phoneNumber) {
							alert('Vui lòng điền đầy đủ thông tin khách hàng');
							return false;
						}

						let deliveryMethod = '';
						let deliveryDetails = '';

						for (let option of deliveryOptions) {
							if (option.checked) {
								if (option.value === 'false') {
									// Giao hàng tại nhà 
									const addressInput = $('#delivery-details input[placeholder="Địa chỉ"]');
									const provinceSelect = $('#delivery-details select:nth-child(1)');
									const districtSelect = $('#delivery-details select:nth-child(2)');
									const wardSelect = $('#delivery-details select:nth-child(3)');

									// Kiểm tra null và giá trị
									if (!addressInput.length || !provinceSelect.length || !districtSelect.length || !wardSelect.length) {
										console.error('Không tìm thấy các phần tử địa chỉ');
										return false;
									}

									const address = addressInput.val().trim();
									const province = provinceSelect.val();
									const district = districtSelect.val();
									const ward = wardSelect.val();

									// Kiểm tra giá trị
									if (!address || province === 'Tỉnh thành' || district === 'Quận/Huyện' || ward === 'Phường/Xã') {
										alert('Vui lòng điền đầy đủ thông tin địa chỉ');
										return false;
									}

									deliveryMethod = 'ĐẶT SHIP';
									deliveryDetails = `Địa chỉ: ${address}, ${ward}, ${district}, ${province}`;
								} else {
									// Nhận tại cửa hàng 
									deliveryMethod = 'NHẬN TẠI CỬA HÀNG';
									const selectedStore = $('input[name="selected_store"]:checked');
									if (selectedStore.length) {
										deliveryDetails = `Cửa hàng: ${selectedStore.val()}`;
									} else {
										alert('Vui lòng chọn cửa hàng');
										return false;
									}
								}
								break;
							}
						}

						// Tạo chi tiết đơn hàng
						let orderItems = '';
						let totalOrderValue = 0;
						//code đang sai
						cart.forEach(item => {

							// Tạo thông tin chi tiết topping
							let toppingsInfo = item.selectedToppings.map(topping =>
								`${topping.toppingName} (${topping.toppingQuantity})`
							).join(', ') || 'Không có topping';

							// Cộng vào tổng giá trị đơn hàng
							totalOrderValue += item.productPrice;

							// Tạo chi tiết đơn hàng
							orderItems += `\n- ${item.productName} (${item.productQuantity})\n-Topping: ${toppingsInfo}\n-Thành tiền: ${formatMoney(item.productPrice)}\n\n`;
						});

						const orderSummary = ` 
THÔNG TIN ĐƠN HÀNG:  
Khách hàng: ${fullName} 
Số điện thoại: ${phoneNumber}  
Phương thức nhận hàng: ${deliveryMethod}
${deliveryDetails}  
CHI TIẾT SẢN PHẨM: ${orderItems}  
Tổng giá trị đơn hàng: ${formatMoney(totalOrderValue)} `;

						GuiMessTeleGram(orderSummary);
						alert("Cảm ơn quý khách đã đặt hàng!");

					}

					$(document).on('input change', '.field-input, select', function () {
						$(this).removeClass('error-input')
							.attr('placeholder', '')
							.css('color', '')
							.css('border', '');
						$(this).next('.error-message').remove();
					});

					// Hàm hiển thị lỗi cho input
					function showError(element, message) {
						element.addClass('error-input')
							.css('border', '2px solid red');

						element.next('.error-message').remove();

						if (element.is('select')) {
							element.after(`<span class="error-message" style="color: red; font-size: 12px;">${message}</span>`);
						} else {
							element.val('').attr('placeholder', message);
						}

						// Xóa lỗi khi người dùng tương tác
						element.on('focus change', function () {
							$(this).removeClass('error-input')
								.css('border', '');
							element.next('.error-message').remove();
						});
					}

					// gửi tin nhắn telegram
					function GuiMessTeleGram(MESSAGE) {
						const BOT_TOKEN = "7728268550:AAF-7rUSnQQNtrn3umKelpotyvYLVuIp5L8";
						const CHAT_ID = "-4730596749";

						const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

						const data = {
							chat_id: CHAT_ID,
							text: MESSAGE,
							parse_mode: "Markdown", // Hoặc "HTML"
						};

						fetch(url, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(data),
						})
							.then((response) => response.json())
							.then((result) => console.log("Gửi tin nhắn thành công:", result))
							.catch((error) => console.error("Lỗi khi gửi tin nhắn:", error));

					}


					// Hàm hiển thị lỗi cho dropdown
					function showErrorDropdown(element, message) {
						element.addClass('error-input')
							.css('border', '2px solid red');

						// Đổi text của tùy chọn mặc định thành thông báo lỗi
						element.find('option:first').text(message).css('color', 'red');

						// Khi người dùng chọn lại dropdown, khôi phục text mặc định và xóa lỗi
						element.on('change', function () {
							$(this).removeClass('error-input')
								.css('border', '');
							element.find('option:first').text(element.data('default'));
						});
					}
				});
				// Khi thay đổi giá trị nhập, ẩn thông báo lỗi tương ứng
				$(document).on('input change', 'input, select', function () {
					$(this).next('.error-message').remove();
				});



			}

			// Gọi hàm render khi trang tải
			renderCartPage();
			updateCartCount();
		});

	</script> -->

	<!-- cập nhật đơn hàng khi có api map -->

	<script>
		jQuery(function ($) {
			function extractPrice(priceString) {
				return parseInt(priceString.replace(/[^0-9]/g, ""), 10) || 0;
			}

			function formatMoney(amount) {
				// Xử lý trường hợp amount không hợp lệ
				if (amount == null || isNaN(amount)) {
					console.warn('Invalid amount in formatMoney:', amount);
					return '0₫';
				}
				return amount.toLocaleString() + '₫';
			}

			function generateUniqueId() {
				return Date.now() + '-' +
					Math.random().toString(36).substr(2, 9) + '-' +
					Math.floor(Math.random() * 100000) + '-' +
					JSON.stringify(Math.random());
			}
			function updateCartCount() {
				let cart = JSON.parse(localStorage.getItem('cart')) || [];
				let itemCount = cart.length;
				$('#CartCount').text(itemCount);
			}
			$(document).ready(function () {
				updateCartCount();
			});

			function renderCartPage() {
				let cart = JSON.parse(localStorage.getItem('cart')) || [];
				// Đảm bảo mỗi sản phẩm đều có id
				cart = cart.map(item => {
					if (!item.id) {
						item.id = generateUniqueId();
					}
					return item;
				});

				// Lưu lại cart với id
				localStorage.setItem('cart', JSON.stringify(cart));
				let $cartWrapper = $('#PageContainer .inner');
				let totalCost = 0;
				// Nếu giỏ hàng rỗng
				if (cart.length === 0) {
					$cartWrapper.html(`
			<h2>Giỏ hàng</h2>
			<p>Giỏ hàng trống</p>
			<p>Tiếp tục mua hàng <a href="index.html">tại đây</a>.</p>
		`);
					return;
				}

				// Tạo bảng sản phẩm
				let cartTableHtml = `
    <h2>Giỏ hàng</h2>
    <div class="cart-container" style="overflow-x: auto; width: 100%;">
        <table class="cart-table" style="width: 100%; border-collapse: collapse; min-width: 600px;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 8px;">Hình ảnh</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Sản phẩm</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Topping</th>
					<th style="border: 1px solid #ddd; padding: 8px;">Đồ uống</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Tổng Tiền</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                ${cart.map((item) => {
					let toppingsTotal = item.selectedToppings.reduce((total, topping) =>
						total + (topping.toppingPrice * topping.toppingQuantity), 0);
					let extraWatersTotal = (item.selectedExtraWaters || []).reduce((total, water) =>
						total + (water.waterPrice * water.waterQuantity), 0);
					let itemTotal = item.productPrice;
					let image = item.productImage;
					if (image.includes("../image_food/")) {
						// Nếu có, thay thế "../image_food/" bằng "./image_food/"
						image = image.replace("../image_food/", "./image_food/");
					}
					totalCost += itemTotal;
					let toppingsHtml = item.selectedToppings.map(topping =>
						`${topping.toppingName} (SL: ${topping.toppingQuantity}) - ${formatMoney(topping.toppingPrice * topping.toppingQuantity)}`
					).join('<br>');
					let extraWatersHtml = (item.selectedExtraWaters || []).map(water =>
						`${water.waterName} (SL: ${water.waterQuantity}) - ${formatMoney(water.waterPrice * water.waterQuantity)}`
					).join('<br>') || 'Không có đồ uống kèm';
					return `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
                                <img src="${image}" alt="${item.productName}" style="max-width: 80px; max-height: 80px;">
                            </td>
                            <td style="border: 1px solid #ddd; padding: 8px;">
                                ${item.productName} - ${formatMoney((item.productPrice - toppingsTotal - extraWatersTotal) / (item.productQuantity))} <br> Số Lượng: ${item.productQuantity} <br> Thành Tiền: ${formatMoney(item.productPrice - toppingsTotal - extraWatersTotal)}
                            </td>
                            <td style="border: 1px solid #ddd; padding: 8px;">
                                ${toppingsHtml || 'Không có topping'}
                            </td>
							<td style="border: 1px solid #ddd; padding: 8px;">
                                        ${extraWatersHtml}
                                    </td>
                            <td style="border: 1px solid #ddd; padding: 8px;">${formatMoney(itemTotal)}</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">
                                <button class="remove-item" data-id="${item.id}" style="color: red; border: none; background: none; cursor: pointer;">Xóa</button>
                            </td>
                        </tr>
                    `;
				}).join('')}
            </tbody>
        </table>
    </div>

    <div class="cart-summary" style="margin-top: 20px; width: 100%; max-width: 100%;">
        <p><strong>Tổng giá:</strong> <strong style="color: red; font-weight: bold;">${formatMoney(totalCost)}</strong></p>
        <p><strong style="color: blue; border: none; background: none;"><i><u> Ưu đãi ngày hôm nay dành riêng cho bạn:</u></i></strong></p>
        
        <p>🚚<i><u> Miễn Phí Vận Chuyển</u></i><br><br>
        
        ✨ Đơn hàng từ 100.000đ trở lên sẽ được miễn phí ship trong bán kính 2km.<br>
                    
        ✨ Với các đơn hàng trong bán kính 2km - 4km, phụ thu phí ship chỉ 15.000đ.<br><br>

        💸 <i><u>Ưu Đãi Đơn Hàng Lớn</u></i><br><br>

        Với đơn hàng từ <strong style="color: blue; border: none; background: none;">500.000đ</strong> trở lên:<br>
        ✅ Giảm ngay 5% tổng giá trị đơn hàng.<br>
        ✅ Miễn phí vận chuyển trong bán kính dưới 5km.</p>
        <p><strong style="color: red; border: none; background: none;"><i><u> Lưu ý:</u></i></strong> Với những đơn hàng dưới 100k, phí ship sẽ được tính theo khoảng cách từ vị trí của bạn đến cơ sở gần bạn nhất của chúng tôi (số km tính theo Google Map) với mức giá là 5000đ/1km</p>

        <p>Tiếp tục mua hàng <a href="index.html"><strong style="color: red; border: none; background: none; cursor: pointer;">tại đây</strong></a> hoặc trên các sàn TMDT <a href="pages/he-thong-cua-hang.html"><strong style="color: red; border: none; background: none; cursor: pointer;">tại đây</strong></a>.</p>
        <button id="checkout-btn" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer;">Đặt hàng</button>
    </div>

    
    <div id="checkout-popup" style="
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background-color: rgba(0,0,0,0.5); 
        z-index: 1000;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
    ">
        <div style="
            background-color: white; 
            padding: 20px; 
            border-radius: 10px; 
            width: 90%; 
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 5vh auto;
        ">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Thông tin đặt hàng</h2>
					<h5 class="section-title" style = "color: red">Quý khách vui lòng kiểm tra kỹ đơn hàng trước khi đặt</h5>
                </div>
                
                <div class="section-content section-customer-information">
                    <div class="fieldset">
                        <!-- Email và Điện thoại -->
                        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
                            <div class="field field-two-thirds" style="flex: 2; min-width: 200px;">
                                <div class="field-input-wrapper">
                                    <label class="field-label" for="popup_billing_address_full_name">Họ và tên</label>
                                    <input 
                                        placeholder="Họ và tên" 
                                        autocapitalize="off" 
                                        spellcheck="false" 
                                        class="field-input" 
                                        type="text" 
                                        id="popup_billing_address_full_name" 
                                        name="billing_address[full_name]"
                                        style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
                                    >
                                </div>
                            </div>
                            <div class="field field-third" style="flex: 1; min-width: 150px;">
                                <div class="field-input-wrapper">
                                    <label class="field-label" for="popup_billing_address_phone">Điện thoại</label>
                                    <input 
                                        placeholder="Điện thoại" 
                                        autocapitalize="off" 
                                        spellcheck="false" 
                                        class="field-input" 
                                        type="tel" 
                                        id="popup_billing_address_phone" 
                                        name="billing_address[phone]"
                                        style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- Phương thức giao hàng -->
                        <div class="shipping-method" style="margin-top: 15px;">
                            <div style="display: flex; flex-wrap: wrap; align-items: center;">
                                <label style="margin-right: 15px;">
                                    <input 
                                        type="radio" 
                                        name="customer_pick_at_location" 
                                        value="false" 
                                        checked
                                    > 
                                    Giao hàng
                                </label>
                                <label>
                                    <input 
                                        type="radio" 
                                        name="customer_pick_at_location" 
                                        value="true"
                                    > 
                                    Nhận tại cửa hàng
                                </label>
                            </div>

                            <!-- Chi tiết giao hàng -->
                            <div id="delivery-details" style="margin-top: 15px;">
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                                    <input 
                                        type="text" 
                                        id="customer-address"
                                        placeholder="Địa chỉ (đầy đủ quận huyện phường xã)" 
                                        style="flex: 3; min-width: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"
                                    >
                                    <button 
                                        id="check-distance-btn" 
                                        style="flex: 1; min-width: 120px; background-color: #4285f4; color: white; padding: 8px; border: none; border-radius: 4px; cursor: pointer;"
                                    >Tính Phí Ship</button>
                                </div>
                                
                                <!-- Khu vực hiển thị kết quả khoảng cách -->
                                <div id="distance-results" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; max-height: 200px; overflow-y: auto;">
                                    
                                    <div id="store-distances">
                                        <!-- Kết quả khoảng cách sẽ được hiển thị ở đây -->
                                    </div>
                                </div>
                            </div>

                            <!-- Chi tiết nhận tại cửa hàng -->
                            <div id="pickup-details" style="display: none;">
                                <!-- Nội dung sẽ được cập nhật khi chọn phương thức nhận tại cửa hàng -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Vùng nhập lưu ý của khách hàng -->
            <div style="margin-top: 20px;">
                <label class="field-label" for="customer_note">Lưu ý của quý khách</label>
                <textarea 
                    id="customer_note" 
                    name="customer_note" 
                    placeholder="Vui lòng điền lưu ý hoặc yêu cầu đặc biệt của quý khách (nếu có)" 
                    style="width: 100%; padding: 10px; min-height: 80px; border: 1px solid #ccc; border-radius: 4px; resize: vertical;"
                ></textarea>
            </div>
            <!-- Nút điều khiển -->
            <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                <button id="close-popup" style="
                    background-color: #f44336; 
                    color: white; 
                    border: none; 
                    padding: 10px 20px; 
                    margin-right: 10px; 
                    border-radius: 4px;
                ">Đóng</button>
                <button id="confirm-payment" style="
                    background-color: #4CAF50; 
                    color: white; 
                    border: none; 
                    padding: 10px 20px; 
                    border-radius: 4px;
                ">Đặt hàng</button>
            </div>
        </div>
    </div>
`;


				const storeLocations = [
					{
						name: "Bánh Mì Chảo Thương Nhớ CS1",
						address: "Số 51 ngõ 14 Mễ Trì Hạ - Nam Từ Liêm - Hà Nội",
						mapLink: "https://maps.app.goo.gl/bzA4bbJAthbHPtsG8",
						phone: "0327 691 700 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS2",
						address: "Số 17 Ngõ 63 Vũ Trọng Phung - Thanh Xuân -Hà Nội",
						mapLink: "https://maps.app.goo.gl/gWxpnB3kEiL4iYnQ7",
						phone: "0869 538 034 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS3",
						address: "Số 1 Ngách 17C Ngõ 35 Trần Thái Tông, Cầu Giấy",
						mapLink: "https://maps.app.goo.gl/DwDubeksMkqfdUu37",
						phone: "0843 163 863 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS4",
						address: "Số 110 P. Trung Liệt, Trung Liệt, Đống Đa, Hà Nội, Việt Nam",
						mapLink: "https://maps.app.goo.gl/bC2dna4EdWbGaafu8",
						phone: "0379 466 682 - 093 1387 046"
					},
					{
						name: "Bánh Mì Chảo Thương Nhớ CS5",
						address: "Số 100 Phạm Huy Thông - Ngoc Khánh - Ba Đình - Hà Nội",
						mapLink: "https://maps.app.goo.gl/CmzQXUwUaGKTZQeK7",
						phone: "035 507 0658 - 093 1387 046"
					}
				];
				$cartWrapper.html(cartTableHtml);

				// Xử lý xóa sản phẩm
				$('#PageContainer .remove-item').on('click', function () {
					let productId = $(this).data('id');
					let cart = JSON.parse(localStorage.getItem('cart')) || [];

					// Lọc ra các sản phẩm không có ID được chọn
					cart = cart.filter(item => item.id !== productId);
					localStorage.setItem('cart', JSON.stringify(cart));

					// Thêm dòng này để cập nhật số lượng
					updateCartCount();
					renderCartPage();
				});

				// Xử lý thanh toán
				$('#PageContainer #checkout-btn').off('click').on('click', function () {
					// Di chuyển popup ra ngoài PageContainer để hiển thị toàn màn hình
					$('body').append($('#checkout-popup'));
					$('#checkout-popup').css({
						'display': 'flex',
						'position': 'fixed',
						'top': '0',
						'left': '0',
						'width': '100%',
						'height': '100%',
						'background-color': 'rgba(0,0,0,0.5)',
						'z-index': '9999',
						'justify-content': 'center',
						'align-items': 'center'
					});
				});

				// Xử lý đóng popup
				$('#close-popup').off('click').on('click', function () {
					$('#checkout-popup').hide();
				});

				// XỬ LÝ NÚT KIỂM TRA KHOẢNG CÁCH
				$('#check-distance-btn').off('click').on('click', function () {
					let address = $('#delivery-details input[type="text"]');
					// Hàm kiểm tra và hiện lỗi nếu cần
					function validateField(element, emptyValue, message) {
						if (element.val().trim() === emptyValue) {
							showError(element, message);
							isValid = false;
						}
					}
					if (address.val().trim() === '') {
						// Thực hiện kiểm tra input và dropdown
						validateField(address, '', 'Vui lòng nhập địa chỉ!');
					}
					else {
						$('#distance-results').show();
						let storeDistancesHtml1 = `
        <h5 style="margin-top: 0;color: blue;">Quý khách vui lòng chờ trong giây lát! Qúy khách hãy điền đủ thông tin phường xã, quận huyện để chúng tôi xác định vị trí chính xác nhất. Đôi khi Google Maps có thể chưa tìm thấy chính xác địa chỉ ngõ ngách của quý khách, nên chúng tôi sẽ chọn địa chỉ gần nhất phù hợp để đảm bảo trải nghiệm tốt nhất cho quý khách. </h5>
        <div class="loading-spinner" style="text-align: center; margin: 20px 0;">
            <i class="fa fa-spinner fa-spin" style="font-size: 24px; color: #4CAF50;"></i>
        </div>
    `;
						$('#store-distances').html(storeDistancesHtml1);

						// Reset thông tin cửa hàng đã chọn
						window.selectedStoreInfo = null;
						fetch('products/geocode.php', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({ address: address.val().trim() })
						})
							.then(response => response.json())
							.then(data => {

								const addressTake = data.formatted_address;

								setTimeout(function () {
									// Tạo mapping giữa các cửa hàng trong storeLocations và dữ liệu khoảng cách
									const storeMapping = {
										0: "CS1",
										1: "CS2",
										2: "CS3",
										3: "CS4",
										4: "CS5"
									};

									$('.distance-value').each(function (index) {
										// Lấy mã cửa hàng tương ứng
										const storeCode = storeMapping[index];

										// Lấy khoảng cách thực từ dữ liệu API thay vì random
										const storeDistance = data.store_distances[storeCode].distance_km;

										let cart = JSON.parse(localStorage.getItem('cart')) || [];
										let totalOrderValue = cart.reduce((sum, item) => sum + item.productPrice, 0);

										// Tính phí ship dựa theo quy tắc
										let shippingFee = 0;
										let distance = parseFloat(storeDistance);

										if (totalOrderValue >= 500000) {
											// Đơn hàng từ 500.000đ trở lên: Miễn phí ship trong bán kính 5km
											if (distance <= 5) {
												shippingFee = 0;
											} else {
												shippingFee = Math.round((distance - 5) * 5000);
											}
										} else if (totalOrderValue >= 100000) {
											// Đơn hàng từ 100.000đ trở lên: Miễn phí ship trong bán kính 2km, 15.000đ cho 2-5km
											if (distance <= 2) {
												shippingFee = 0;
											} else if (distance <= 4) {
												shippingFee = 15000;
											} else {
												shippingFee = 15000 + Math.round((distance - 4) * 5000);
											}
										} else {
											// Đơn hàng dưới 100.000đ: 5.000đ/km
											shippingFee = Math.round(distance * 5000);
										}

										// Lưu thông tin khoảng cách vào thuộc tính dữ liệu của phần tử
										$(this).data('distance', storeDistance);
										$(this).data('shippingFee', shippingFee);

										$(this).html(`<strong>${storeDistance}km</strong> <strong style="color: red; border: none; background: none;"><i><u>Phí ship:</u></i> ${formatMoney(shippingFee)}</strong>`);
									});

									// Highlight cửa hàng gần nhất
									const closestStoreCode = data.closest_store;
									const closestStoreIndex = Object.keys(storeMapping).find(key => storeMapping[key] === closestStoreCode);
									if (closestStoreIndex) {
										$(`.distance-value[data-store-id="${closestStoreIndex}"]`).closest('.store-distance-item').css('background-color', '#f5f5dc');
									}

									$('.select-store-btn').off('click').on('click', function () {
										const storeId = $(this).data('store-id');
										const selectedStore = storeLocations[storeId];

										// Lấy thông tin khoảng cách và phí ship
										const distanceElement = $(this).closest('.store-distance-item').find('.distance-value');
										const distanceText = distanceElement.data('distance');
										const shippingFeeText = distanceElement.data('shippingFee');

										// Đánh dấu cửa hàng được chọn
										$('.store-distance-item').css('background-color', '');
										$(this).closest('.store-distance-item').css('background-color', '#f0f8ff');

										// Hiển thị thông tin cửa hàng đã chọn
										$('#selected-store-info').html(`
                <h5 style="margin: 0 0 10px 0;"><i class="fa fa-shopping-cart" style="color: #4CAF50;"></i> Cửa hàng đã chọn</h5>
                <p style="margin: 0 0 5px 0;"><strong>${selectedStore.name}</strong></p>
                <p style="margin: 0 0 5px 0;">${selectedStore.address}</p>
                <p style="margin: 0 0 5px 0;">Khoảng cách: ${distanceText}km</p>
                <p style="margin: 0 0 5px 0; color: #d32f2f; font-weight: bold;">Phí Ship: ${formatMoney(shippingFeeText)}</p>
                <input type="hidden" name="selected_store_id" value="${storeId}">
                <input type="hidden" name="selected_store_name" value="${selectedStore.name}">
                <input type="hidden" name="selected_store_address" value="${selectedStore.address}">
                <input type="hidden" name="selected_store_distance" value="${distanceText}">
                <input type="hidden" name="selected_store_shipping_fee" value="${shippingFeeText}">
            `).show();

										// Lưu lại thông tin đầy đủ
										window.selectedStoreInfo = {
											id: storeId,
											name: selectedStore.name,
											address: selectedStore.address,
											distance: distanceText + 'km',
											shippingFee: formatMoney(shippingFeeText),
											shippingFeeValue: shippingFeeText // Lưu giá trị số của phí ship
										};

										// Gửi thông báo thành công
										if (!$('#store-selection-success').length) {
											$('#selected-store-info').after(`
                    <div id="store-selection-success" class="alert alert-success" style="margin-top: 10px; padding: 10px; background-color: #dff0d8; color: #3c763d; border-radius: 5px;">
                        Bạn đã chọn cửa hàng thành công! Vui lòng tiếp tục để hoàn tất đơn hàng.
                    </div>
                `);
										}

										// Tùy chọn: cuộn đến thông tin đã chọn
										$('#distance-results').animate({
											scrollTop: $('#selected-store-info').position().top - 50
										}, 500);
									});

								}, 1000);

								let storeDistancesHtml = `<h5 style="margin-top: 0;">Địa chỉ của bạn là:</h5><h4 style="margin-top: 0;color : red;">${addressTake}</h4> <h5><b><u style = "color : blue;">Cách các cơ sở của chúng tôi:</u></b></h5>

        <div class="store-distance-list">
            ${storeLocations.map((store, index) => `
                <div class="store-distance-item" style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                    <h5 style="margin: 0 0 5px 0;">${store.name}</h5>
                    <p style="margin: 0 0 5px 0; font-size: 13px;">${store.address}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="distance-value" data-store-id="${index}">
                            <i>Đang tính khoảng cách...</i>
                        </span>
                        <a href="${store.mapLink}" target="_blank" style="
                            background-color: #4CAF50; 
                            color: white; 
                            padding: 3px 8px; 
                            text-decoration: none; 
                            border-radius: 3px;
                            font-size: 12px;
                        ">Xem bản đồ</a>
                    </div>
                    <div class="store-selection" style="margin-top: 8px;">
                        <button class="select-store-btn" data-store-id="${index}" style="
                            background-color: #007bff;
                            color: white;
                            border: none;
                            padding: 5px 10px;
                            border-radius: 3px;
                            cursor: pointer;
                            font-size: 13px;
                        ">Chọn cửa hàng này</button>
                    </div>
                </div>
            `).join('')}
        </div>
        <div id="selected-store-info" style="display: none; margin-top: 15px; padding: 10px; background-color: #e8f5e9; border-radius: 5px; border-left: 4px solid #4CAF50;"></div>
    `;

								$('#store-distances').html(storeDistancesHtml);
							})
							.catch(error => {
								console.error('Error:', error);
								// Xử lý lỗi nếu cần
								$('#store-distances').html('<p>Đã xảy ra lỗi khi tìm địa chỉ</p>');
							});
					}

					function showError(element, message) {
						element.addClass('error-input')
							.css('border', '2px solid red');

						element.next('.error-message').remove();

						if (element.is('select')) {
							element.after(`<span class="error-message" style="color: red; font-size: 12px;">${message}</span>`);
						} else {
							element.val('').attr('placeholder', message);
						}

						// Xóa lỗi khi người dùng tương tác
						element.on('focus change', function () {
							$(this).removeClass('error-input')
								.css('border', '');
							element.next('.error-message').remove();
						});
					}




				});

				// Xử lý radio button giao hàng/nhận tại cửa hàng
				$('input[name="customer_pick_at_location"]').off('change').on('change', function () {
					if ($(this).val() === 'false') {
						$('#delivery-details').show();
						$('#pickup-details').hide();
					} else {
						$('#delivery-details').hide();
						$('#pickup-details').empty(); // Xóa nội dung cũ

						// Tạo danh sách cửa hàng với chức năng chọn
						let storeListHtml = `
<h3>Danh sách cửa hàng</h3>
<div class="store-list" style="margin-top: 10px;">
	${storeLocations.map((store, index) => `
		<div class="store-item" data-store-id="${store.name}" style="
			border: 1px solid #ddd; 
			padding: 10px; 
			margin-bottom: 10px; 
			border-radius: 5px;
			position: relative;
			cursor: pointer;
		">
			<input 
				type="radio" 
				id="store-${index}" 
				name="selected_store" 
				value="${store.name}" 
				style="display: none;"
			>
			<label for="store-${index}" style="display: block; cursor: pointer;">
				<h4 style="margin: 0 0 10px 0;">${store.name}</h4>
				<p style="margin: 5px 0;"><strong>Địa chỉ:</strong> ${store.address}</p>
				<p style="margin: 5px 0;"><strong>Điện thoại:</strong> ${store.phone}</p>
			</label>
			<div style="margin-top: 10px;">
				<a href="${store.mapLink}" target="_blank" style="
					background-color: #4CAF50; 
					color: white; 
					padding: 5px 10px; 
					text-decoration: none; 
					border-radius: 3px;
					display: inline-block;
				">Xem vị trí trên bản đồ</a>
			</div>
		</div>
	`).join('')}
</div>
`;
						$('#pickup-details').html(storeListHtml).show();
						// Thêm sự kiện click cho toàn bộ store-item
						$(document).on('click', '.store-item', function (e) {
							if ($(e.target).closest('a').length) return;

							// Chọn radio button tương ứng
							const radio = $(this).find('input[type="radio"]');
							radio.prop('checked', true);

							// Loại bỏ viền của tất cả các store-item
							$('.store-item').css('border', '1px solid #ddd');

							// Thêm viền cho store-item được chọn
							$(this).css('border', '2px solid #4CAF50');

							// Xóa viền đỏ của danh sách store
							$('.store-list').css('border', 'none');

							// Lưu thông tin cửa hàng được chọn
							const storeId = parseInt($(this).data('store-id'));
							if (!isNaN(storeId) && storeLocations[storeId]) {
								window.selectedStoreInfo = {
									id: storeId,
									name: storeLocations[storeId].name,
									address: storeLocations[storeId].address,
									distance: "0km", // Không tính khoảng cách khi nhận tại cửa hàng
									shippingFee: "0₫",
									shippingFeeValue: 0
								};
							}
						});

						$('#pickup-details')
							.html(storeListHtml)
							.show();
					}
				});

				// Chỉ gán sự kiện một lần cho nút xác nhận thanh toán

				$(document).ready(function () {
					$('#confirm-payment').off('click').on('click', function () {
						let isValid = true;

						// Xóa cảnh báo cũ
						$('.field-input, select').removeClass('error-input');

						let fullName = $('#popup_billing_address_full_name');
						let phone = $('#popup_billing_address_phone');
						let isPickup = $('input[name="customer_pick_at_location"]:checked').val() === 'true';

						// Kiểm tra tên
						if (fullName.val().trim() === '') {
							showError(fullName, 'Vui lòng nhập họ và tên!');
							isValid = false;
						}

						// Kiểm tra số điện thoại
						if (phone.val().trim() === '') {
							showError(phone, 'Vui lòng nhập số điện thoại!');
							isValid = false;
						} else if (!/^\d{10,11}$/.test(phone.val().trim())) {
							// Kiểm tra nếu số điện thoại không phải 10-11 chữ số
							showError(phone, 'Số điện thoại không hợp lệ');
							isValid = false;
						}

						if (!isPickup) {
							// Kiểm tra thông tin giao hàng
							let address = $('#delivery-details input[type="text"]');
							// Hàm kiểm tra và hiện lỗi nếu cần
							function validateField(element, emptyValue, message) {
								if (element.val().trim() === emptyValue) {
									showError(element, message);
									isValid = false;
								}
							}
							// Thực hiện kiểm tra input và dropdown
							validateField(address, '', 'Vui lòng nhập địa chỉ!');
							if (isValid && !window.selectedStoreInfo) {
								alert('Vui lòng ấn Tính Phí Ship để chọn cửa hàng gần bạn nhất trước khi thanh toán');
								isValid = false;
							}

						}
						else {
							// Kiểm tra cửa hàng được chọn khi là pickup
							let selectedStore = $('input[name="selected_store"]:checked').val();

							if (!selectedStore) {
								$('.store-list').css('border', '2px solid red');
								isValid = false;
							} else {
								$('.store-list').css('border', 'none');
								// Đảm bảo window.selectedStoreInfo được cập nhật nếu chưa
								if (!window.selectedStoreInfo) {
									const storeRadio = $('input[name="selected_store"]:checked');
									const storeItem = storeRadio.closest('.store-item');
									const storeId = parseInt(storeItem.data('store-id'));
									if (!isNaN(storeId) && storeLocations[storeId]) {
										window.selectedStoreInfo = {
											id: storeId,
											name: storeLocations[storeId].name,
											address: storeLocations[storeId].address,
											distance: "0km",
											shippingFee: "0₫",
											shippingFeeValue: 0
										};
									} else {
										window.selectedStoreInfo = {
											name: selectedStore,
											address: "Nhận tại cửa hàng",
											distance: "0km",
											shippingFee: "0₫",
											shippingFeeValue: 0
										};
									}
								}
							}

							// Sự kiện click cho từng store item
							$('.store-item').on('click', function () {
								$('.store-item').css('border', '1px solid #ddd');
								$(this).css('border', '2px solid #4CAF50');
								$('.store-list').css('border', 'none');
							});
						}

						if (isValid) {
							$('#checkout-popup').hide();
							createOrderSummary();
							localStorage.removeItem('cart');  // Xóa toàn bộ sản phẩm trong giỏ hàng từ localStorage
							//window.location.href = './'; // Chuyển về trang chủ
						}
					});
					function normalizeImagePath(path) {
						if (path.startsWith('../')) {
							return path;
						} else if (path.startsWith('./')) {
							return '../' + path.substring(2);
						} else {
							return '../' + path;
						}
					}
					// Đóng popup
					$('#close-popup').on('click', function () {
						$('#checkout-popup').hide();
					});

					function createOrderSummary() {
						// Kiểm tra các phần tử trước khi truy xuất
						const fullNameEl = document.getElementById('popup_billing_address_full_name');
						const phoneNumberEl = document.getElementById('popup_billing_address_phone');
						const deliveryOptions = document.getElementsByName('customer_pick_at_location');
						const customerNoteEl = document.getElementById('customer_note');
						// Kiểm tra null
						if (!fullNameEl || !phoneNumberEl) {
							console.error('Không tìm thấy phần tử thông tin khách hàng');
							return false;
						}

						const fullName = fullNameEl.value.trim();
						const phoneNumber = phoneNumberEl.value.trim();
						const customerNote = customerNoteEl ? customerNoteEl.value.trim() : ''; // Lấy giá trị ghi chú
						// Kiểm tra giá trị
						if (!fullName || !phoneNumber) {
							alert('Vui lòng điền đầy đủ thông tin khách hàng');
							return false;
						}

						let deliveryMethod = '';
						let deliveryDetails = '';
						let shippingFee = 0; // Thêm biến phí ship

						for (let option of deliveryOptions) {
							if (option.checked) {
								if (option.value === 'false') {
									// Giao hàng tại nhà 
									const addressInput = $('#customer-address'); // ID của input địa chỉ

									// Kiểm tra null và giá trị
									if (!addressInput.length) {
										console.error('Không tìm thấy các phần tử địa chỉ');
										return false;
									}

									const address = addressInput.val().trim();

									// Kiểm tra giá trị
									if (!address) {
										alert('Vui lòng điền đầy đủ thông tin địa chỉ');
										return false;
									}

									deliveryMethod = 'ĐẶT SHIP';
									deliveryDetails = `${address}`;

									// Lấy thông tin phí ship từ cửa hàng đã chọn
									if (window.selectedStoreInfo) {
										shippingFee = window.selectedStoreInfo.shippingFeeValue || 0;
									}
								} else {
									// Nhận tại cửa hàng 
									deliveryMethod = 'NHẬN TẠI CỬA HÀNG';
									const selectedStore = $('input[name="selected_store"]:checked');
									if (selectedStore.length) {
										deliveryDetails = selectedStore.val();
										// Nếu là nhận tại cửa hàng, phí ship = 0
										shippingFee = 0;
									} else {
										alert('Vui lòng chọn cửa hàng');
										return false;
									}

								}
								break;
							}
						}

						// Tạo chi tiết đơn hàng
						let orderItems = '';
						let totalOrderValue = 0;

						let cart = JSON.parse(localStorage.getItem('cart')) || [];

						// Tạo HTML cho sản phẩm trong modal
						let orderItemsHtml = '';

						cart.forEach(item => {
							// Tính tổng giá topping
							let toppingsTotal = item.selectedToppings.reduce((total, topping) =>
								total + (topping.toppingPrice * topping.toppingQuantity), 0);
							let extraWatersTotal = (item.selectedExtraWaters || []).reduce((total, water) =>
								total + (water.waterPrice * water.waterQuantity), 0);
							// Tạo thông tin chi tiết topping
							let toppingsInfo = item.selectedToppings.map(topping =>
								`${topping.toppingName} (${topping.toppingQuantity}) - ${formatMoney(topping.toppingPrice * topping.toppingQuantity)}`
							).join('<br>') || 'Không có topping';

							let extraWatersInfo = (item.selectedExtraWaters || []).map(water =>
								`${water.waterName} (${water.waterQuantity}) - ${formatMoney(water.waterPrice * water.waterQuantity)}`
							).join('<br>') || 'Không có đồ uống kèm';
							// Cộng vào tổng giá trị đơn hàng
							totalOrderValue += item.productPrice;

							// Chuẩn bị đường dẫn hình ảnh
							let image = item.productImage;
							if (image.includes("../image_food/")) {
								image = image.replace("../image_food/", "./image_food/");
							}

							// Tạo HTML cho mỗi sản phẩm
							orderItemsHtml += `
            <div class="order-item" style="display: flex; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <div class="order-item-image" style="width: 80px; margin-right: 15px;">
                    <img src="${image}" alt="${item.productName}" style="width: 100%; border-radius: 5px;">
                </div>
                <div class="order-item-details" style="flex-grow: 1;">
                    <h4 style="margin: 0 0 5px 0;">${item.productName} x ${item.productQuantity}</h4>
                    <p style="margin: 0 0 5px 0; font-size: 14px; color: #666;">
                        Giá: ${formatMoney((item.productPrice - toppingsTotal - extraWatersTotal) / item.productQuantity)}
                    </p>
                    <div style="font-size: 13px; margin-top: 5px;">
                        <strong>Topping:</strong><br>
                        ${toppingsInfo}
                    </div>
					<div style="font-size: 13px; margin-top: 5px;">
                        <strong>Đồ Uống:</strong><br>
                        ${extraWatersInfo}
                    </div>
                </div>
                <div class="order-item-price" style="width: 100px; text-align: right; font-weight: bold;">
                    ${formatMoney(item.productPrice)}
                </div>
            </div>
        `;

							// Tạo thông tin cho Telegram
							orderItems += `\n- ${item.productName} (${item.productQuantity})\n  Topping: ${item.selectedToppings.map(t => `${t.toppingName} (${t.toppingQuantity})`).join(', ') || 'Không có'}\n  Đồ uống: ${(item.selectedExtraWaters || []).map(w => `${w.waterName} (${w.waterQuantity})`).join(', ') || 'Không có'}\n  Thành tiền: ${formatMoney(item.productPrice)}\n`;
						});

						// Kiểm tra ưu đãi dựa trên tổng giá trị đơn hàng
						let discount = 0;
						let discountText = '';
						let discountHtml = '';


						// Tính tổng thanh toán cuối cùng
						const finalTotal = totalOrderValue - discount + shippingFee;
						// Xử lý ghi chú khách hàng cho Telegram
						const noteForTelegram = customerNote ? `\nGhi chú khách hàng: ${customerNote}` : '\nKhông có ghi chú';
						// Thông tin cho Telegram
						const orderSummary = ` 
THÔNG TIN ĐƠN HÀNG:  
Khách hàng: ${fullName} 
Số điện thoại: ${phoneNumber}  
Phương thức nhận hàng: ${deliveryMethod} ${noteForTelegram}
Địa chỉ: ${deliveryDetails}  
CHI TIẾT SẢN PHẨM: ${orderItems}  
Tổng giá trị sản phẩm: ${formatMoney(totalOrderValue)}${discountText}
Cửa Hàng Làm Đơn: ${window.selectedStoreInfo.name}
Phí ship: ${formatMoney(shippingFee)}
TỔNG THANH TOÁN: ${formatMoney(finalTotal)} `;

						$.ajax({
							url: 'save_order1.php',
							type: 'POST',
							data: {
								fullName: fullName,
								phoneNumber: phoneNumber,
								deliveryMethod: deliveryMethod,
								noteForTelegram: noteForTelegram,
								deliveryDetails: deliveryDetails,
								orderItems: orderItems,
								totalOrderValue: totalOrderValue,
								discountText: discountText,
								shippingFee: shippingFee,
								finalTotal: finalTotal,
								storeName: window.selectedStoreInfo.name
							},
							success: function (response) {
								console.log('Đã gửi đơn hàng:', response);
							}
						});
						// Gửi thông tin đến Telegram
						GuiMessTeleGram(orderSummary);
						// Phần ghi chú khách hàng cho hiển thị trong modal
						const customerNoteHtml = customerNote
							? `
        <div class="customer-notes" style="margin: 20px 0; padding: 15px; background: #fff9e6; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h3 style="margin-top: 0; margin-bottom: 10px; font-size: 16px;">Yêu cầu của khách hàng:</h3>
            <p style="margin: 0; font-style: italic;">${customerNote}</p>
        </div>
        `
							: '';
						// Tạo modal thông báo đặt hàng thành công với thông tin chi tiết
						const successModal = $(`
        <div id="order-success-modal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;">
            <div style="
                background: white;
                border-radius: 10px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                
                <!-- Header -->
                <div style="background: #4CAF50; color: white; padding: 15px 20px; border-radius: 10px 10px 0 0; position: sticky; top: 0; z-index: 1;">
                    <h2 style="margin: 0; font-size: 22px; text-align: center;">
                        <i class="fa fa-shopping-cart" style="margin-right: 10px;"></i>Đặt hàng thành công
                    </h2>
                </div>
                
                <!-- Body -->
                <div style="padding: 20px;">
                    <!-- Thông tin khách hàng -->
                    <div class="customer-info" style="margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                        <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                            Thông tin đơn hàng
                        </h3>
                        <div style="display: flex; flex-wrap: wrap;">
                            <div style="width: 48%; margin-bottom: 10px;">
                                <strong>Khách hàng:</strong> ${fullName}
                            </div>
                            <div style="width: 48%; margin-bottom: 10px;">
                                <strong>Số điện thoại:</strong> ${phoneNumber}
                            </div>
                            <div style="width: 100%; margin-bottom: 10px;">
                                <strong>Phương thức nhận hàng:</strong> ${deliveryMethod}
                            </div>
                            <div style="width: 100%;">
                                <strong>${deliveryMethod === 'ĐẶT SHIP' ? 'Địa chỉ giao hàng:' : 'Cửa hàng:'}</strong> ${deliveryDetails}
                            </div>
                            ${window.selectedStoreInfo && deliveryMethod === 'ĐẶT SHIP' ? `
                            <div style="width: 100%; margin-top: 10px;">
                                <strong>Cửa hàng bạn chọn:</strong> ${window.selectedStoreInfo.name} (${window.selectedStoreInfo.distance})
                            </div>` : ''}
                        </div>
                    </div>
                     ${customerNoteHtml}
                    <!-- Chi tiết sản phẩm -->
                    <div class="order-details" style="margin-bottom: 20px;">
                        <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                            Chi tiết sản phẩm
                        </h3>
                        ${orderItemsHtml}
                    </div>
                    
                    <!-- Tổng cộng -->
                    <div class="order-summary" style="border-top: 2px solid #eee; padding-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Tổng giá trị sản phẩm:</span>
                            <span>${formatMoney(totalOrderValue)}</span>
                        </div>
                        
                        ${discountHtml}
                        
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Phí ship:</span>
                            <span>${formatMoney(shippingFee)}</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 10px; border-top: 1px solid #ddd; font-weight: bold; font-size: 18px;">
                            <span>TỔNG THANH TOÁN:</span>
                            <span style="color: #E53935;">${formatMoney(finalTotal)}</span>
                        </div>
                    </div>
                    
                    <!-- Thông báo -->
                    <div class="order-notice" style="margin-top: 20px; text-align: center; font-style: italic; color: #555; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        Cảm ơn quý khách đã đặt hàng. Nhân viên của chúng tôi sẽ liên hệ xác nhận đơn hàng trong thời gian sớm nhất!
                    </div>
                </div>
                
                <!-- Footer -->
                <div style="padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end;">
                    <button id="backToHome" style="
                        background: #4CAF50;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;">Quay về trang chủ</button>
                </div>
            </div>
        </div>
    `);

						// Thêm modal vào body
						$('body').append(successModal);

						// Xóa giỏ hàng
						localStorage.removeItem('cart');

						// Xử lý sự kiện khi nhấn nút quay về trang chủ
						$('#backToHome').on('click', function () {
							window.location.href = './';
						});
					}
					$(document).on('input change', '.field-input, select', function () {
						$(this).removeClass('error-input')
							.attr('placeholder', '')
							.css('color', '')
							.css('border', '');
						$(this).next('.error-message').remove();
					});
					function convertTemplateToPhpArray(templateString) {
						// Phân tích template string để trích xuất dữ liệu
						// Ví dụ từ mẫu của bạn: `THÔNG TIN ĐƠN HÀNG: Khách hàng: ${fullName}...`

						// Chúng ta sẽ tạo một đối tượng chứa các biến cần trích xuất từ template
						const variableRegex = /\${([^}]+)}/g;
						const variables = [];
						let match;

						while ((match = variableRegex.exec(templateString)) !== null) {
							variables.push(match[1]);
						}

						// Tạo mã PHP cho mảng
						let phpArrayCode = "$orderInfo = [\n    [\n";

						// Thêm các trường cố định và trường biến động
						phpArrayCode += "        'handle' => 'order_summary',\n";

						// Thêm các biến từ template string
						if (variables.includes('fullName')) {
							phpArrayCode += "        'orderCustomer' => $fullName,\n";
						}

						if (variables.includes('phoneNumber')) {
							phpArrayCode += "        'orderPhone' => $phoneNumber,\n";
						}

						if (variables.includes('deliveryMethod')) {
							phpArrayCode += "        'deliveryMethod' => $deliveryMethod,\n";
						}

						if (variables.includes('noteForTelegram')) {
							phpArrayCode += "        'telegramNote' => $noteForTelegram,\n";
						}

						if (variables.includes('deliveryDetails')) {
							phpArrayCode += "        'deliveryAddress' => $deliveryDetails,\n";
						}

						if (variables.includes('orderItems')) {
							phpArrayCode += "        'orderItems' => $orderItems,\n";
						}

						if (variables.includes('totalOrderValue')) {
							phpArrayCode += "        'totalValue' => formatMoney($totalOrderValue),\n";
						}

						if (variables.includes('discountText')) {
							phpArrayCode += "        'discountInfo' => $discountText,\n";
						}

						if (variables.includes('window.selectedStoreInfo.name')) {
							// Xử lý đặc biệt cho trường hợp gọi thuộc tính của đối tượng
							phpArrayCode += "        'storeName' => $window->selectedStoreInfo->name,\n";
						}

						if (variables.includes('shippingFee')) {
							phpArrayCode += "        'shippingFee' => formatMoney($shippingFee),\n";
						}

						if (variables.includes('finalTotal')) {
							phpArrayCode += "        'finalTotal' => formatMoney($finalTotal),\n";
						}

						// Loại bỏ dấu phẩy cuối cùng nếu có
						phpArrayCode = phpArrayCode.trimRight();
						if (phpArrayCode.endsWith(',')) {
							phpArrayCode = phpArrayCode.slice(0, -1);
						}

						phpArrayCode += "\n    ]\n    // Có thể thêm các đơn hàng khác vào đây\n];";

						return phpArrayCode;
					}

					// Hàm hiển thị lỗi cho input
					function showError(element, message) {
						element.addClass('error-input')
							.css('border', '2px solid red');

						element.next('.error-message').remove();

						if (element.is('select')) {
							element.after(`<span class="error-message" style="color: red; font-size: 12px;">${message}</span>`);
						} else {
							element.val('').attr('placeholder', message);
						}

						// Xóa lỗi khi người dùng tương tác
						element.on('focus change', function () {
							$(this).removeClass('error-input')
								.css('border', '');
							element.next('.error-message').remove();
						});
					}

					// gửi tin nhắn telegram
					function GuiMessTeleGram(MESSAGE) {
						const BOT_TOKEN = "7728268550:AAF-7rUSnQQNtrn3umKelpotyvYLVuIp5L8";
						const CHAT_ID = "-4730596749";

						const url = `https://8286c96b-soft-dew-4f24.thanhcong190693.workers.dev/bot${BOT_TOKEN}/sendMessage`;

						const data = {
							chat_id: CHAT_ID,
							text: MESSAGE,
							parse_mode: "Markdown", // Hoặc "HTML"
						};

						fetch(url, {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify(data),
						})
							.then((response) => response.json())
							.then((result) => console.log("Gửi tin nhắn thành công:", result))
							.catch((error) => console.error("Lỗi khi gửi tin nhắn:", error));

					}
					// Hàm gửi tin nhắn Telegram an toàn thông qua backend
					function guiMessTeleGram(message) {
						// Kiểm tra đầu vào
						if (!message || typeof message !== 'string' || message.trim() === '') {
							console.error('Tin nhắn không hợp lệ');
							return Promise.reject('Tin nhắn không hợp lệ');
						}

						// Gửi request đến backend thay vì trực tiếp đến API Telegram
						return fetch('./send_telegram.php', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								// Thêm CSRF token nếu website của bạn sử dụng
								// 'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
							},
							body: JSON.stringify({
								message: message
							}),
							credentials: 'same-origin' // Đảm bảo cookies và session được gửi kèm
						})
							.then(response => {
								if (!response.ok) {
									throw new Error('Lỗi khi gửi tin nhắn: ' + response.status);
								}
								return response.json();
							})
							.then(data => {
								if (data.success) {
									console.log('Gửi tin nhắn thành công');
									return data;
								} else {
									console.error('Không thể gửi tin nhắn:', data.error);
									throw new Error(data.error);
								}
							})
							.catch(error => {
								console.error('Lỗi:', error);
								throw error;
							});
					}

					// Ví dụ sử dụng
					// guiMessTeleGram('Đây là tin nhắn test')
					//     .then(result => console.log('Kết quả:', result))
					//     .catch(error => console.error('Có lỗi xảy ra:', error));

					// Hàm hiển thị lỗi cho dropdown
					function showErrorDropdown(element, message) {
						element.addClass('error-input')
							.css('border', '2px solid red');

						// Đổi text của tùy chọn mặc định thành thông báo lỗi
						element.find('option:first').text(message).css('color', 'red');

						// Khi người dùng chọn lại dropdown, khôi phục text mặc định và xóa lỗi
						element.on('change', function () {
							$(this).removeClass('error-input')
								.css('border', '');
							element.find('option:first').text(element.data('default'));
						});
					}
				});
				// Khi thay đổi giá trị nhập, ẩn thông báo lỗi tương ứng
				$(document).on('input change', 'input, select', function () {
					$(this).next('.error-message').remove();
				});



			}

			// Gọi hàm render khi trang tải
			renderCartPage();
			updateCartCount();
		});

	</script>

	<style>
		.error-message {
			color: red;
			font-size: 14px;
			margin-top: 5px;
		}
	</style>
	<footer>
		<div class="footer-top">
			<div class="footer-top-overlay"></div>
			<div class="wrapper">
				<div class="inner">
					<div class="grid-uniform">
						<div class="grid__item large--three-twelfths medium--one-half small--one-whole">
							<div class="ft-contact">

								<div class="ft-contact-logo text-center">
									<a href="index.html"><img
											src="../theme.hstatic.net/1000313040/1000406925/14/logo_ftee64.png"
											alt="Bánh Mì Chảo Thương Nhớ"></a>
								</div>

								<div class="ft-contact-address">
									<i class="fa fa-home" aria-hidden="true"></i> Số 100 Phạm Huy Thông, P. Ngọc Khánh,
									Q.
									Ba Đình, TP. Hà Nội
								</div>
								<div class="ft-contact-tel">
									<i class="fa fa-mobile" aria-hidden="true"></i> <a
										href="tel:0931387046">0931387046</a>
								</div>
								<div class="ft-contact-email">
									<i class="fa fa-envelope" aria-hidden="true"></i> <a
										href="mailto:banhmichaothuongnho@gmail.com">banhmichaothuongnho@gmail.com</a>
								</div>
							</div>
						</div>

						<div class="grid__item large--three-twelfths medium--one-half small--one-whole">
							<div class="ft-menu">
								<h4>Chính sách</h4>
								<ul class="no-bullets">


									<li><a href="./pages/chinh-sach-va-quy-dinh-chung.html">Chính sách và quy định
											chung</a></li>

									<li><a href="./pages/chinh-sach-giao-dich-thanh-toan.html">Chính sách giao dịch,
											thanh toán</a></li>

									<li><a href="./pages/chinh-sach-doi-tra.html">Chính sách đổi trả</a></li>

									<li><a href="./pages/chinh-sach-bao-mat.html">Chính sách bảo mật</a></li>

									<li><a href="./pages/chinh-sach-van-chuyen.html">Chính sách vận chuyển</a></li>

								</ul>
							</div>
						</div>

						<div class="grid__item large--three-twelfths medium--one-half small--one-whole">
							<div class="ft-subscribe-wrapper">
								<h4>Bành Mì Chảo Thương Nhớ</h4>
								<div class="ft-subscribe">
									<div id="company-info"></div>

									<form accept-charset="UTF-8" action="pages/he-thong-cua-hang.html"
										class="contact-form" method="post" name="myForm" onsubmit="validateForm()">
										<input name="form_type" type="hidden" value="customer">
										<input name="utf8" type="hidden" value="✓">



										<div class="input-group">
											<input type="email" required value="" placeholder="Nhập email của bạn..."
												name="contact[email]" id="Email" class="input-group-field"
												aria-label="email@example.com">
											<input type="hidden" name="contact[tags]" value="newsletter">
											<span class="input-group-btn">
												<button type="submit" name="subscribe" id="subscribe" value="GỬI"><i
														class="fa fa-paper-plane" aria-hidden="true"></i></button>
											</span>
										</div>

									</form>

								</div>
							</div>
							<div class="ft-social-network">

								<a href="https://www.facebook.com/profile.php?id=100067891252186" target="_blank"><i
										class="fa fa-facebook" aria-hidden="true"></i></a>



								<a href="https://www.facebook.com/profile.php?id=100067891252186" target="_blank"><i
										class="fa fa-instagram" aria-hidden="true"></i></a>


								<a href="#" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i></a>


								<a href="https://www.youtube.com/" target="_blank"><i class="fa fa-youtube"
										aria-hidden="true"></i></a>

							</div>
						</div>

						<div class="grid__item large--three-twelfths medium--one-half small--one-whole">
							<h4>🎉 Mỗi thứ ba hàng tuần, chúng tôi dành tặng các combo ưu đãi đặc biệt như lời tri ân
								đến khách
								hàng. liên hệ ngay với chúng tôi để chúng tôi được phục vụ bạn!</h4>

							<div id="owl-home-main-banners-slider-ft" class="owl-carousel owl-theme">
								<!-- hình ảnh đã thông báo bộ công thương -->
								<div class="item">
									<div class="ft-img">
										<a href="../theme.hstatic.net/1000313040/1000406925/14/hg_img1ee64.png"
											data-fancybox="home-gallery-images" data-caption=""><img
												src="../theme.hstatic.net/1000313040/1000406925/14/hg_img_thumb1ee64.png"
												alt="" /></a>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footer-bottom">
			<div class="wrapper">
				<div class="inner">
					<div class="grid">
						<div class="grid__item large--six-twelfths medium--one-whole small--one-whole pull-right">
							<div class="ft-copyright-menu text-right">
								<ul class="no-bullets">


								</ul>
							</div>
						</div>
						<div class="grid__item large--six-twelfths medium--one-whole small--one-whole">
							<div class="ft-copyright">
								Copyrights © 2018 by <a target="_blank" href="https://banhmichaothuongnho.com/">Bánh Mì
									Chảo Thương Nhớ</a>.
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<script>
		// Hàm tải nội dung từ file txt bên ngoài
		function loadCompanyInfo() {
			fetch('products/company-info.txt')
				.then(response => response.text())
				.then(data => {
					// Chuyển đổi dấu xuống dòng thành <br>
					const formattedData = '<p>' + data.replace(/\n/g, '<br>') + '</p>';
					document.getElementById('company-info').innerHTML = formattedData;
				})
				.catch(error => console.error('Lỗi khi tải thông tin:', error));
		}


		// Gọi hàm khi trang được tải
		document.addEventListener('DOMContentLoaded', loadCompanyInfo);
	</script>

	<div id="back-to-top" class="text-center medium--hide small--hide">
		<i class="fa fa-angle-up" aria-hidden="true"></i>
	</div>


	<script src='../hstatic.net/0/0/global/api.jquery.js' type='text/javascript'></script>

	<script src='../hstatic.net/0/0/global/option_selection.js' type='text/javascript'></script>

	<script src='../theme.hstatic.net/1000313040/1000406925/14/fastclick.minee64.js' type='text/javascript'></script>
	<script src='../theme.hstatic.net/1000313040/1000406925/14/suplo-fnee64.js' type='text/javascript'></script>
	<script src='../theme.hstatic.net/1000313040/1000406925/14/scriptee64.js' type='text/javascript'></script>
	<script src='../theme.hstatic.net/1000313040/1000406925/14/timberee64.js' type='text/javascript'></script>

	<link rel="stylesheet" href="../cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
	<script src="../cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>

	<script src='../theme.hstatic.net/1000313040/1000406925/14/handlebars.minee64.js' type='text/javascript'></script>
	<!-- /snippets/ajax-cart-template.liquid -->

	<script id="AjaxQty" type="text/template">

	<div class="ajaxcart__qty">
		<button type="button" class="ajaxcart__qty-adjust ajaxcart__qty--minus icon-fallback-text" data-id="{{key}}" data-qty="{{itemMinus}}">
			<span class="icon icon-minus" aria-hidden="true"></span>
			<span class="fallback-text" aria-hidden="true">&minus;</span>
			<span class="visually-hidden">Giảm số lượng sản phẩm đi 1</span>
		</button>
		<input type="text" class="ajaxcart__qty-num" value="{{itemQty}}" min="0" data-id="{{key}}" aria-label="quantity" pattern="[0-9]*">
		<button type="button" class="ajaxcart__qty-adjust ajaxcart__qty--plus icon-fallback-text" data-id="{{key}}" data-qty="{{itemAdd}}">
			<span class="icon icon-plus" aria-hidden="true"></span>
			<span class="fallback-text" aria-hidden="true">+</span>
			<span class="visually-hidden">Tăng số lượng sản phẩm lên 1</span>
		</button>
	</div>
	
</script>
	<script id="JsQty" type="text/template">

	<div class="js-qty">
		<button type="button" class="js-qty__adjust js-qty__adjust--minus icon-fallback-text" data-id="{{key}}" data-qty="{{itemMinus}}">
			<span class="icon icon-minus" aria-hidden="true"></span>
			<span class="fallback-text" aria-hidden="true">&minus;</span>
			<span class="visually-hidden">Giảm số lượng sản phẩm đi 1</span>
		</button>
		<input type="text" class="js-qty__num" value="{{itemQty}}" min="1" data-id="{{key}}" aria-label="quantity" pattern="[0-9]*" name="{{inputName}}" id="{{inputId}}">
		<button type="button" class="js-qty__adjust js-qty__adjust--plus icon-fallback-text" data-id="{{key}}" data-qty="{{itemAdd}}">
			<span class="icon icon-plus" aria-hidden="true"></span>
			<span class="fallback-text" aria-hidden="true">+</span>
			<span class="visually-hidden">Tăng số lượng sản phẩm lên 1</span>
		</button>
	</div>
	
</script>

	<script src='../theme.hstatic.net/1000313040/1000406925/14/ajax-cartee64.js' type='text/javascript'></script>
	<script>
		jQuery(function ($) {
			ajaxCart.init({
				formSelector: '#AddToCartForm',
				cartContainer: '#CartContainer',
				addToCartSelector: '#AddToCart',
				cartCountSelector: '#CartCount',
				cartCostSelector: '#CartCost',
				moneyFormat: "{{amount}}₫"
			});
		});

		jQuery(document.body).on('afterCartLoad.ajaxCart', function (evt, cart) {
			// Bind to 'afterCartLoad.ajaxCart' to run any javascript after the cart has loaded in the DOM
			timber.RightDrawer.open();
		});
	</script>

	<style>
		.total-cost {
			color: rgb(51, 255, 0);
			font-weight: bold;
			font-size: 18px;
		}
	</style>
	<!-- Validate quantity form & trigger zoom -->
	<script>
		$("document").ready(function () {

			$(".checkout_btn_2").on("click", function () {
				alert('a');
				event.preventDefault();
				var checked = $('textarea#CartSpecialInstructions').val();
				if (checked == '') {
					alert('Bạn chưa điền thông tin vào chú thích cho chủ cửa hàng !');
				} else {
					window.location = 'cart.html';
				}

			});

			$(function () {
				$(".js-qty__num").keypress(function (event) {
					if (event.which != 8 && event.which != 0 && (event.which < 48 || event.which > 57)) {
						return false;
					}
				});
			});
			if ($(window).width() > 768) {
				setTimeout(function () {
					$("#ProductThumbs .thumbnail-item:first-child a").trigger('click');
				}, 10);
			};
		});
	</script>

	<script>
		$(document).ready(function () {
			$().fancybox({
				thumbs: true,
				hash: false,
				loop: true,
			});
		});
	</script>

	<script>
		jQuery(document).ready(function () {


			document.addEventListener('DOMContentLoaded', function () {
				// Tìm form chứa input email
				const form = document.querySelector('form.contact-form');

				if (form) {
					form.addEventListener('submit', function (event) {
						// Ngăn form gửi đi ngay lập tức
						event.preventDefault();

						// Lấy giá trị email và loại bỏ khoảng trắng
						const emailInput = document.getElementById('Email');
						const email = emailInput.value.trim();

						// Biểu thức chính quy đơn giản để kiểm tra email
						const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

						if (email === '') {
							alert('Vui lòng nhập địa chỉ email.');
							emailInput.focus();
							return;
						}

						if (!emailRegex.test(email)) {
							alert('Địa chỉ email không hợp lệ. Vui lòng kiểm tra lại.');
							emailInput.focus();
							return;
						}

						// Nếu email hợp lệ, tiếp tục gửi form
						form.submit();
					});
				}
			});


			var offset = 220;
			var duration = 500;
			jQuery(window).scroll(function () {
				if (jQuery(this).scrollTop() > offset) {
					jQuery('#back-to-top').fadeIn(duration);
				} else {
					jQuery('#back-to-top').fadeOut(duration);
				}
			});

			jQuery('#back-to-top').click(function (event) {
				event.preventDefault();
				jQuery('html, body').animate({
					scrollTop: 0
				}, duration);
				return false;
			})
		});

		window.onscroll = changePos;

		function changePos() {
			var header = $("#header");
			var headerheight = $("#header").height();
			if (window.pageYOffset > headerheight) {
				header.addClass('sticky-header');
			} else {
				header.removeClass('sticky-header');
			}
		}

	</script>

	<script>
		$(document).ready(function () {
			var acc = document.getElementsByClassName("accordion");
			var i;

			for (i = 0; i < acc.length; i++) {
				acc[i].onclick = function () {
					this.classList.toggle("active");
					var panel = this.nextElementSibling;
					if (panel.style.maxHeight) {
						panel.style.maxHeight = null;
					} else {
						panel.style.maxHeight = panel.scrollHeight + "px";
					}
				}
			}
			if ($(window).width() > 769) {
				$('.accordion').trigger('click');
			}
		});
	</script>


	<script>
		function openTab(evt, tabName) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}
			document.getElementById(tabName).style.display = "block";
			evt.currentTarget.className += " active";
		}

		// Get the element with id="defaultOpen" and click on it
		//document.getElementById("defaultOpen").click();
	</script>

	<!---------------quick view --------------->

	<style>
		.modal {
			display: none;
			position: fixed;
			z-index: 99999;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
			background-color: rgb(0, 0, 0);
			background-color: rgba(0, 0, 0, 0.4);
			transtion: all .5s;
		}

		.modal-content {
			background-color: #fefefe;
			margin: 5% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 80%;
			max-width: 780px;
			transform: translatey(-30px);
			transition: all .5s;
		}

		.close {
			color: #aaa;
			font-size: 28px;
			font-weight: bold;
			position: absolute;
			right: 0;
			top: 0;
			width: 40px;
			text-align: center;
		}

		.close:hover,
		.close:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}
	</style>

	<script>
		$(document).ready(function () {
			$("#home-main-slider").owlCarousel({
				items: 1,
				itemsDesktop: [1000, 1],
				itemsDesktopSmall: [900, 1],
				itemsTablet: [600, 1],
				itemsMobile: false,
				navigation: false,
				pagination: true,
				slideSpeed: 300,
				autoPlay: true,
				paginationSpeed: 400,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});
			$("#home-main-slidermb").owlCarousel({
				items: 1,
				itemsDesktop: [1000, 1],
				itemsDesktopSmall: [900, 1],
				itemsTablet: [600, 1],
				itemsMobile: false,
				navigation: false,
				pagination: true,
				slideSpeed: 300,
				autoPlay: true,
				paginationSpeed: 400,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});
			$(".owl-home-main-banners-slider-pd").owlCarousel({
				items: 4,
				itemsDesktop: [1000, 4],
				itemsDesktopSmall: [900, 2],
				itemsTablet: [600, 2],
				itemsMobile: false,
				navigation: false,
				pagination: false,
				slideSpeed: 300,
				paginationSpeed: 400,
				autoPlay: 5000,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});
			$("#related-products-slider").owlCarousel({
				items: 4,
				itemsDesktop: [1000, 4],
				itemsDesktopSmall: [900, 4],
				itemsTablet: [768, 4],
				itemsMobile: [480, 2],
				navigation: true,
				pagination: false,
				slideSpeed: 300,
				paginationSpeed: 400,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});
			$("#owl-home-main-banners-slider-art").owlCarousel({
				items: 3,
				itemsDesktop: [1000, 3],
				itemsDesktopSmall: [900, 3],
				itemsTablet: [768, 2],
				itemsMobile: [480, 1],
				navigation: true,
				pagination: false,
				slideSpeed: 300,
				paginationSpeed: 400,
				autoPlay: 5000,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});

			$("#owl-home-main-banners-slider-ft").owlCarousel({
				items: 1,
				itemsDesktop: [1000, 1],
				itemsDesktopSmall: [900, 1],
				itemsTablet: [600, 1],
				itemsMobile: false,
				navigation: false,
				pagination: true,
				slideSpeed: 300,
				paginationSpeed: 400,
				autoPlay: 5000,
				navigationText: ['<i class="fa fa-angle-left" aria-hidden="true"></i>', '<i class="fa fa-angle-right" aria-hidden="true"></i>']
			});
		});
	</script>

	<!-- Load Facebook SDK for JavaScript -->
	<style>
		/* CSS cho nút hỗ trợ chính */
		.support-button {
			position: fixed;
			bottom: 40px;
			right: 20px;
			z-index: 999999999;
			display: flex;
			align-items: center;
			justify-content: center;
			width: 60px;
			height: 60px;
			background-color: #0f75bc;
			border-radius: 50%;
			color: white;
			cursor: move;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
			transition: all 0.3s ease;
		}

		.support-button:hover {
			transform: scale(1.1);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
		}

		.support-button i {
			font-size: 24px;
		}

		/* Hiệu ứng pulse */
		.support-button::before {
			content: '';
			position: absolute;
			width: 100%;
			height: 100%;
			border-radius: 50%;
			background-color: #0f75bc;
			opacity: 0.7;
			animation: pulse 1.5s infinite;
			z-index: -1;
		}

		@-webkit-keyframes pulse {
			0% {
				-webkit-transform: scale(0.9);
				-moz-transform: scale(0.9);
				-ms-transform: scale(0.9);
				transform: scale(0.9);
			}

			70% {
				-webkit-transform: scale(1);
				-moz-transform: scale(1);
				-ms-transform: scale(1);
				transform: scale(1);
				box-shadow: 0 0 0 50px rgba(15, 117, 188, 0);
			}

			100% {
				-webkit-transform: scale(0.9);
				-moz-transform: scale(0.9);
				-ms-transform: scale(0.9);
				transform: scale(0.9);
				box-shadow: 0 0 0 0 rgba(15, 117, 188, 0);
			}
		}

		/* Menu tùy chọn - với background mờ và chiều rộng động */
		.support-options {
			position: absolute;
			bottom: 75px;
			right: 0;
			display: none;
			flex-direction: column;
			gap: 15px;
			width: 100px;
			/* Chỉ đủ rộng cho icon ban đầu */
			background-color: rgba(255, 255, 255, 0.5);
			/* Background mờ 50% */
			border-radius: 15px;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
			padding: 15px;
			transition: all 0.3s ease;
			overflow: visible;
			/* Cho phép con bên trong vượt ra ngoài */
		}

		.support-options.visible {
			display: flex;
		}

		/* Tùy chọn với hiệu ứng hover mở rộng - áp dụng cho cả Messenger, Hotline và Zalo */
		.expandable-option {
			position: relative;
			display: flex;
			align-items: center;
			width: 60px;
			border-radius: 50%;
			box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
			transition: all .3s;
			cursor: pointer;
			background: rgba(255, 255, 255, 0.9);
			height: 60px;
			margin-left: auto;
			margin-right: auto;
			overflow: hidden;
			z-index: 1;
		}

		.expandable-option .icon-container {
			display: inline-block;
			text-align: center;
			width: 60px;
			font-size: 24px;
			line-height: 60px;
			border-radius: 50%;
			box-shadow: 0 0 0 0 rgba(15, 117, 188, 0.3);
			-webkit-animation: pulse 1.5s infinite;
			transition: all .3s;
			z-index: 2;
		}

		/* Màu cho icon Messenger */
		.expandable-option.messenger-option .icon-container {
			background: #0084FF;
			color: #ffffff;
		}

		/* Màu cho icon Hotline */
		.expandable-option.hotline-option .icon-container {
			background: #0f75bc;
			color: #ffffff;
		}

		/* Màu cho icon Zalo */
		.expandable-option.zalo-option .icon-container {
			background: #0068ff;
			color: #ffffff;
		}

		.expandable-option .text-container {
			display: inline-block;
			width: 0px;
			height: 60px;
			transition: all .3s;
			overflow: hidden;
			text-align: center;
			z-index: 1;
		}

		.expandable-option .text-container span {
			display: block;
			margin: auto;
			line-height: 60px;
			font-size: 16px;
			width: 100%;
			font-weight: bold;
			color: #2c394c;
		}

		/* Mở rộng khi hover */
		.expandable-option:hover {
			width: 200px;
			border-radius: 40px;
		}

		/* Thay đổi container cha khi con hover */
		.expandable-option:hover~.expandable-option,
		.expandable-option:hover {
			z-index: 10;
		}

		/* Mở rộng container cha khi các con hover */
		.support-options:has(.expandable-option:hover) {
			width: 210px;
			/* Đủ rộng cho phần mở rộng */
			background-color: rgba(255, 255, 255, 0.5);
			/* Giữ nguyên độ mờ */
		}

		.expandable-option:hover .icon-container {
			-webkit-animation: none;
			border-radius: 4px;
		}

		.expandable-option:hover .text-container {
			width: calc(100% - 60px);
		}

		.expandable-option.messenger-option:hover .text-container span {
			color: #0084FF;
		}

		.expandable-option.hotline-option:hover .text-container span {
			color: #0f75bc;
		}

		.expandable-option.zalo-option:hover .text-container span {
			color: #0068ff;
		}
	</style>

	<div id="supportButton" class="support-button">
		<i class="fa fa-comments"></i>

		<div class="support-options" id="supportOptions">
			<!-- Messenger với hiệu ứng hover mở rộng -->
			<div class="expandable-option messenger-option" id="messengerOption">
				<div class="icon-container">
					<img src="https://cdn-icons-png.flaticon.com/512/5968/5968771.png" alt="Messenger" width="60"
						height="60">
				</div>
				<div class="text-container">
					<span>Chat Messenger</span>
				</div>
			</div>

			<!-- Zalo với hiệu ứng hover mở rộng -->
			<div class="expandable-option zalo-option" id="zaloOption">
				<div class="icon-container">
					<img src="https://stc-zaloprofile.zdn.vn/pc/v1/images/zalo_sharelogo.png" alt="Zalo" width="60"
						height="60" style="margin-top: 12px;">
				</div>
				<div class="text-container">
					<span>Chat Zalo</span>
				</div>
			</div>


			<!-- Hotline với hiệu ứng hover mở rộng -->
			<div class="expandable-option hotline-option" id="hotlineOption">
				<div class="icon-container">
					<i class="fa fa-phone"></i>
				</div>
				<div class="text-container">
					<span>093 1387 046</span>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// Lấy các phần tử DOM
			const supportButton = document.getElementById('supportButton');
			const supportOptions = document.getElementById('supportOptions');
			const messengerOption = document.getElementById('messengerOption');
			const zaloOption = document.getElementById('zaloOption');
			const hotlineOption = document.getElementById('hotlineOption');

			// Biến để theo dõi trạng thái
			let isMenuOpen = false;
			let isDragging = false;
			let wasDragging = false;
			let initialX, initialY;
			let offsetX = 0, offsetY = 0;
			let startTime = 0;

			// Lấy vị trí đã lưu từ localStorage
			const savedKey = 'supportButtonPosition';
			const savedPosition = localStorage.getItem(savedKey);

			// Nếu có vị trí đã lưu, áp dụng nó
			if (savedPosition) {
				try {
					const position = JSON.parse(savedPosition);
					supportButton.style.left = position.x + 'px';
					supportButton.style.top = position.y + 'px';
					supportButton.style.right = 'auto';
					supportButton.style.bottom = 'auto';
				} catch (e) {
					console.error('Error parsing saved position', e);
				}
			}

			// Xử lý sự kiện click cho nút hỗ trợ
			supportButton.addEventListener('click', function (e) {
				// Nếu không kéo thả, mở hoặc đóng menu
				if (!wasDragging) {
					isMenuOpen = !isMenuOpen;
					if (isMenuOpen) {
						supportOptions.classList.add('visible');
					} else {
						supportOptions.classList.remove('visible');
					}
				}
			});

			// Xử lý sự kiện click cho tùy chọn Messenger
			messengerOption.addEventListener('click', function (e) {
				e.stopPropagation(); // Ngăn chặn sự kiện lan ra ngoài
				window.open('https://m.me/112531760938142', '_blank');
				// Đóng menu sau khi chọn
				isMenuOpen = false;
				supportOptions.classList.remove('visible');
			});

			// Xử lý sự kiện click cho tùy chọn Zalo
			zaloOption.addEventListener('click', function (e) {
				e.stopPropagation(); // Ngăn chặn sự kiện lan ra ngoài
				window.open('https://zalo.me/0931387046', '_blank');
				// Đóng menu sau khi chọn
				isMenuOpen = false;
				supportOptions.classList.remove('visible');
			});

			// Xử lý sự kiện click cho tùy chọn Hotline
			hotlineOption.addEventListener('click', function (e) {
				e.stopPropagation(); // Ngăn chặn sự kiện lan ra ngoài
				window.location.href = 'tel:0931387046';
				// Đóng menu sau khi chọn
				isMenuOpen = false;
				supportOptions.classList.remove('visible');
			});

			// Đóng menu khi click ra ngoài
			document.addEventListener('click', function (e) {
				if (isMenuOpen && !supportButton.contains(e.target)) {
					isMenuOpen = false;
					supportOptions.classList.remove('visible');
				}
			});

			// Chức năng kéo thả
			supportButton.addEventListener('mousedown', dragStart);
			supportButton.addEventListener('touchstart', dragStart);

			function dragStart(e) {
				// Lưu thời gian bắt đầu để phân biệt giữa click và drag
				startTime = new Date().getTime();

				isDragging = true;
				wasDragging = false;

				// Lấy vị trí ban đầu
				initialX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
				initialY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

				// Lấy vị trí hiện tại của phần tử
				const rect = supportButton.getBoundingClientRect();
				offsetX = initialX - rect.left;
				offsetY = initialY - rect.top;

				// Thêm sự kiện di chuyển và kết thúc
				document.addEventListener('mousemove', dragMove);
				document.addEventListener('touchmove', dragMove, { passive: false });
				document.addEventListener('mouseup', dragEnd);
				document.addEventListener('touchend', dragEnd);
			}

			function dragMove(e) {
				if (!isDragging) return;

				// Nếu đã di chuyển, đánh dấu là đang kéo thả
				wasDragging = true;

				// Đóng menu khi kéo
				if (isMenuOpen) {
					isMenuOpen = false;
					supportOptions.classList.remove('visible');
				}

				// Ngăn chặn các hành động cuộn trang mặc định khi kéo
				if (e.type === 'touchmove') {
					e.preventDefault();
				}

				// Tính toán vị trí mới
				let clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
				let clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

				// Cập nhật vị trí
				supportButton.style.right = 'auto';
				supportButton.style.bottom = 'auto';
				supportButton.style.left = (clientX - offsetX) + 'px';
				supportButton.style.top = (clientY - offsetY) + 'px';
			}

			function dragEnd(e) {
				if (!isDragging) return;

				// Tính thời gian đã trôi qua
				const endTime = new Date().getTime();
				const timeDiff = endTime - startTime;

				// Nếu đây là kéo thả (không phải click)
				if (wasDragging) {
					// Lưu vị trí mới
					const rect = supportButton.getBoundingClientRect();
					const position = {
						x: rect.left,
						y: rect.top
					};
					localStorage.setItem(savedKey, JSON.stringify(position));
				}

				// Reset trạng thái
				isDragging = false;

				// Sau một khoảng thời gian ngắn, reset wasDragging
				// Điều này cho phép click hoạt động sau khi kéo thả
				setTimeout(() => {
					wasDragging = false;
				}, 10);

				// Xóa các sự kiện
				document.removeEventListener('mousemove', dragMove);
				document.removeEventListener('touchmove', dragMove);
				document.removeEventListener('mouseup', dragEnd);
				document.removeEventListener('touchend', dragEnd);
			}
		});
	</script>

</body>

</html>